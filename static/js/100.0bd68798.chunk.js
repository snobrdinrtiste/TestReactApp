(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[100,219],{1063:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n=r(43),a=r(164),i=r(165),l=r(166),s=r(167),o=r(647),c=r(670),u=r(703),d=r(649),y=(r(644),r(650),r(645),r(648)),h=r(728),f=r(982),b={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},p=function(e){Object(l.a)(r,e);var t=Object(s.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).scale=0,n}return Object(i.a)(r,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;var e=this.visibleSublayers.map((function(e){return e.toExportImageJSON()}));return e.length?JSON.stringify(e):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&Object(f.a)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(b[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression}));return e.length?JSON.stringify(e.reduce((function(e,t){return e[t.id]=t.definitionExpression,e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers;r&&r.forEach((function r(n){var a=e.scale,i=0===a,l=0===n.minScale||a<=n.minScale,s=0===n.maxScale||a>=n.maxScale;n.visible&&(i||l&&s)&&(n.sublayers?n.sublayers.forEach(r):t.unshift(n))}));var n=this._get("visibleSublayers");return!n||n.length!==t.length||n.some((function(e,r){return t[r]!==e}))?t:n}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=Object(n.a)(Object(n.a)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),r}(Object(u.b)(c.a));Object(o.a)([Object(d.b)({readOnly:!0})],p.prototype,"dynamicLayers",null),Object(o.a)([Object(d.b)({readOnly:!0})],p.prototype,"hasDynamicLayers",null),Object(o.a)([Object(d.b)()],p.prototype,"layer",null),Object(o.a)([Object(d.b)({readOnly:!0})],p.prototype,"layers",null),Object(o.a)([Object(d.b)({readOnly:!0})],p.prototype,"layerDefs",null),Object(o.a)([Object(d.b)({type:Number})],p.prototype,"scale",void 0),Object(o.a)([Object(d.b)(h.a)],p.prototype,"timeExtent",void 0),Object(o.a)([Object(d.b)({readOnly:!0})],p.prototype,"version",null),Object(o.a)([Object(d.b)({readOnly:!0})],p.prototype,"visibleSublayers",null),p=Object(o.a)([Object(y.a)("esri.layers.mixins.ExportImageParameters")],p)},1265:function(e,t,r){"use strict";r.r(t),r.d(t,"getPatternDescriptor",(function(){return I})),r.d(t,"getSymbolLayerFill",(function(){return S})),r.d(t,"previewSymbol3D",(function(){return F}));var n=r(652),a=r.n(n),i=r(43),l=r(653),s=r(840),o=r(957),c=(r(644),r(655)),u=r(645),d=r(651),y=r(657),h=r(659),f=r(1047),b=r(1206),p=r(1207),v=r(1266),m=r(1267),g=r(1170),O=r(1e3),_=22,j=120,w=u.a.getLogger("esri.symbols.support.previewSymbol3D");function L(e){var t=e.outline,r=Object(d.i)(e.material)?e.material.color:null,n=Object(d.i)(r)?r.toHex():null;if(Object(d.h)(t))return"fill"===e.type&&"#ffffff"===n?{color:"#bdc3c7",width:.75}:null;var a=Object(h.c)(t.size)||0;return{color:"rgba("+(Object(d.i)(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=e.a,n=Object(o.a)(e),a=n.h,i=n.s/t,l=100-(100-n.v)/t,s=Object(o.d)({h:a,s:i,v:l}),c=s.r,u=s.g,d=s.b;return[c,u,d,r]}function x(e){return"water"===e.type?Object(d.h)(e.color)?null:e.color:Object(d.h)(e.material)||Object(d.h)(e.material.color)?null:e.material.color}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=x(e);if(!r){if("fill"===e.type)return null;var n=f.a.r,a=Object(v.b)(n,t);return[a,a,a,100]}for(var i=r.toRgba(),l=0;l<3;l++)i[l]=Object(v.b)(i[l],t);return i}function I(e,t){return A.apply(this,arguments)}function A(){return(A=Object(l.a)(a.a.mark((function e(t,r){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==(n=t.style)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,Object(f.c)(Object(s.a)("esri/symbols/patterns/".concat(n,".png")),r.toCss(!0));case 5:return e.t0=e.sent,e.abrupt("return",{type:"pattern",x:0,y:0,src:e.t0,width:5,height:5});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return e.outline?L(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function C(e,t){var r=x(e);if(!r)return null;var n="rgba(";return n+=Object(v.b)(r.r,t)+",",n+=Object(v.b)(r.g,t)+",",(n+=Object(v.b)(r.b,t)+",")+r.a+");"}function V(e,t){var r=C(e,t);return r?{color:r,width:Math.min(e.size?Object(h.c)(e.size):.75,80)}:{}}function z(e,t,r){var n=.75*r;return{type:"linear",x1:n?.25*n:0,y1:n?.5*n:0,x2:n||4,y2:n?.5*n:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function M(e,t){var r,n=t&&t.size?Object(h.c)(t.size):null,a=t&&t.maxSize?Object(h.c)(t.maxSize):null,i=t&&t.disableUpsampling,l=e.symbolLayers,o=[],c=0,u=0,d=l.getItemAt(l.length-1);return d&&"icon"===d.type&&(r=d.size&&Object(h.c)(d.size)),l.forEach((function(l){if("icon"===l.type||"object"===l.type){var d="icon"===l.type?l.size&&Object(h.c)(l.size):0,y=n||d?Math.ceil(Math.min(n||d,a||j)):_;if(l&&l.resource&&l.resource.href){var f=function(e,t){var r=t&&t.resource,n=r&&r.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(n&&"object"!==t.type)return Promise.resolve(Object(O.f)(e,t));var a=Object(s.a)("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?Object(g.resolveWebStyleSymbol)(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch((function(e){return e})).then((function(e){var t;return(null==e||null==(t=e.thumbnail)?void 0:t.url)||a})):Promise.resolve(a)}(e,l).then((function(e){var t=l.get("material.color"),r=function(e){return"icon"===e.type?"multiply":"tint"}(l);return Object(m.b)(e,y,t,r,i)})).then((function(e){var t=e.width,r=e.height;return c=Math.max(c,t),u=Math.max(u,r),[{shape:{type:"image",x:0,y:0,width:t,height:r,src:e.url},fill:null,stroke:null}]}));o.push(f)}else{var w,k=y;"icon"===l.type&&r&&n&&(k=y*(d/r));var x="tall"===(null==t?void 0:t.symbolConfig)||(null==t||null==(w=t.symbolConfig)?void 0:w.isTall)||"object"===l.type&&function(e){var t=e.depth,r=e.height,n=e.width;return n&&t&&r&&n===t&&n<r}(l);c=Math.max(c,x?20:k),u=Math.max(u,k),o.push(Promise.resolve(function(e,t,r){var n=[];if(!e)return n;switch(e.type){case"icon":var a=t,i=t;switch(e.resource&&e.resource.primitive||b.b){case"circle":n.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:S(e,0),stroke:L(e)});break;case"square":n.push({shape:{type:"path",path:[{command:"M",values:[0,i]},{command:"L",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,i]},{command:"Z",values:[]}]},fill:S(e,0),stroke:L(e)});break;case"triangle":n.push({shape:{type:"path",path:[{command:"M",values:[0,i]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,i]},{command:"Z",values:[]}]},fill:S(e,0),stroke:L(e)});break;case"cross":n.push({shape:{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[.5*a,i]},{command:"M",values:[0,.5*i]},{command:"L",values:[a,.5*i]}]},stroke:E(e)});break;case"x":n.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,i]},{command:"M",values:[a,0]},{command:"L",values:[0,i]}]},stroke:E(e)});break;case"kite":n.push({shape:{type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*i]},{command:"L",values:[.5*a,i]},{command:"Z",values:[]}]},fill:S(e,0),stroke:L(e)})}break;case"object":switch(e.resource&&e.resource.primitive||p.b){case"cone":var l=z(S(e,0),S(e,-.6),r?20:t),s=Object(v.c)(t,r);n.push({shape:s[0],fill:l}),n.push({shape:s[1],fill:l});break;case"inverted-cone":var o=S(e,0),c=z(o,S(e,-.6),t),u=Object(v.h)(t);n.push({shape:u[0],fill:c}),n.push({shape:u[1],fill:o});break;case"cube":var d=Object(v.d)(t,r);n.push({shape:d[0],fill:S(e,0)}),n.push({shape:d[1],fill:S(e,-.3)}),n.push({shape:d[2],fill:S(e,-.5)});break;case"cylinder":var y=z(S(e,0),S(e,-.6),r?20:t),h=Object(v.e)(t,r);n.push({shape:h[0],fill:y}),n.push({shape:h[1],fill:y}),n.push({shape:h[2],fill:S(e,0)});break;case"diamond":var f=Object(v.f)(t);n.push({shape:f[0],fill:S(e,-.3)}),n.push({shape:f[1],fill:S(e,0)}),n.push({shape:f[2],fill:S(e,-.3)}),n.push({shape:f[3],fill:S(e,-.7)});break;case"sphere":var m=z(S(e,0),S(e,-.6));m.x1=0,m.y1=0,m.x2=.25*t,m.y2=.25*t,n.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:m});break;case"tetrahedron":var g=Object(v.j)(t);n.push({shape:g[0],fill:S(e,-.3)}),n.push({shape:g[1],fill:S(e,0)}),n.push({shape:g[2],fill:S(e,-.6)})}}return n}(l,k,x)))}}})),Object(y.j)(o).then((function(e){var r=[];return e.forEach((function(e){e.value?r.push(e.value):e.error&&w.warn("error while building swatchInfo!",e.error)})),Object(m.a)(r,[c,u],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}function R(){return(R=Object(l.a)(a.a.mark((function e(t,r){var n,l,s,o,c,u,y,f,b,p,g,O,w,A,E,C,z,M,R,F,T,D,N,P,B,H,U,q,W,G,J;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="mesh-3d"===t.type,l=t.symbolLayers,s=r&&r.size?Object(h.c)(r.size):null,o=r&&r.maxSize?Object(h.c)(r.maxSize):null,c=s||_,u=[],y=0,f=0,b=!1,p=0;case 3:if(!(p<l.length)){e.next=39;break}if(g=l.getItemAt(p),O=[],!n||"fill"===g.type){e.next=7;break}return e.abrupt("continue",36);case 7:w=v.l.fill[0],e.t0=g.type,e.next="fill"===e.t0?11:"line"===e.t0?22:"extrude"===e.t0?25:"water"===e.t0?30:35;break;case 11:if(A=L(g),E=Math.min(c,o||j),y=Math.max(y,E),f=Math.max(f,E),b=!0,C=S(g,0),z="pattern"in g&&g.pattern,M=x(g),e.t1=!n&&Object(d.i)(z)&&"style"===z.type&&"solid"!==z.style&&M,!e.t1){e.next=20;break}return e.next=19,I(z,M);case 19:C=e.sent;case 20:return O.push({shape:w,fill:C,stroke:A}),e.abrupt("break",35);case 22:return R={stroke:V(g,0),shape:w},y=Math.max(y,_),f=Math.max(f,_),O.push(R),e.abrupt("break",35);case 25:return F=Object(i.a)({join:"round"},V(g,-.4)),T=S(g,0),D=S(g,-.2),N=Math.min(c,o||j),P=Object(v.g)(N),F.width=1,O.push({shape:P[0],fill:D,stroke:F}),O.push({shape:P[1],fill:D,stroke:F}),O.push({shape:P[2],fill:T,stroke:F}),_,B=.7*_+.5*N,y=Math.max(y,22),f=Math.max(f,B),e.abrupt("break",35);case 30:return H=x(g),U=k(H),q=k(H,2),W=k(H,3),G=Object(v.k)(),b=!0,O.push({shape:G[0],fill:U}),O.push({shape:G[1],fill:q}),O.push({shape:G[2],fill:W}),J=Math.min(c,o||j),y=Math.max(y,J),f=Math.max(f,J),e.abrupt("break",35);case 35:u.push(O);case 36:p++,e.next=3;break;case 39:return e.abrupt("return",Promise.resolve(Object(m.a)(u,[y,f],{node:r&&r.node,scale:b,opacity:r&&r.opacity})));case 40:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t){if(0===e.symbolLayers.length)return Promise.reject(new c.a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var r=null;switch(e.type){case"point-3d":r=M(e,t);break;case"line-3d":r=function(e,t){var r,n=e.symbolLayers,a=[],l=Object(O.h)(e),s=t&&t.size?Object(h.c)(t.size):null,o=(t&&t.maxSize?Object(h.c)(t.maxSize):null)||80,c=0,u=0;return n.forEach((function(e,t){if(e&&("line"===e.type||"path"===e.type)){var n=[];switch(e.type){case"line":var l=V(e,0),d=l&&l.width||0;0===t&&(r=d);var y=Math.min(s||d,o),h=0===t?y:s?y*(d/r):y,f=h>20?2*h:40;u=Math.max(u,h),c=Math.max(c,f),l.width=h,n.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[c,.5*u]}]},stroke:l});break;case"path":var b=Math.min(s||_,o),p=S(e,0),m=S(e,-.2),g=C(e,-.4),O=g?{color:g,width:1}:{};if("quad"===e.profile){var j,w,L=null!=(j=e.width)?j:e.size,k=null!=(w=e.height)?w:e.size,x=Object(v.i)(L&&k?L/k:1,0===k,0===L),I=Object(i.a)(Object(i.a)({},O),{},{join:"bevel"});n.push({shape:x[0],fill:m,stroke:I}),n.push({shape:x[1],fill:m,stroke:I}),n.push({shape:x[2],fill:p,stroke:I})}else n.push({shape:v.l.pathSymbol3DLayer[0],fill:m,stroke:O}),n.push({shape:v.l.pathSymbol3DLayer[1],fill:p,stroke:O});u=Math.max(u,b),c=u}a.push(n)}})),Promise.resolve(Object(m.a)(a,[c,u],{node:t&&t.node,scale:l,opacity:t&&t.opacity}))}(e,t);break;case"polygon-3d":case"mesh-3d":r=function(e,t){return R.apply(this,arguments)}(e,t)}return r||Promise.reject(new c.a("symbolPreview: swatchInfo3D","symbol not supported."))}},1846:function(e,t,r){"use strict";r.r(t);var n=r(43),a=r(164),i=r(165),l=r(166),s=r(167),o=r(647),c=r(711),u=r(687),d=r(770),y=(r(644),r(707)),h=r(645),f=r(649),b=r(648),p=r(779),v=(r(872),r(670)),m=r(684),g=(r(650),r(646)),O=r(652),_=r.n(O),j=r(673),w=r(653),L=r(691),k=r(786),x=r(668),S=r(740),I=r(689),A=r(651),E=r(657),C=r(659),V=r(679),z=r(1063),M=r(725),R=r(879);r(655),r(1381);function F(e){return Object(A.h)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type}var T=r(1380),D=r(1048),N=r(1227),P=r(1e3),B=r(971);function H(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var r=e.visualVariables.find((function(e){return"size"===e.type})),n=function(e,t){var r=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!=t&&t.levels?t.levels[r]:null}(t,r);return n?new B.a({field:r.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}var U=r(945),q=r(905),W=/^-?(\d+)(\.(\d+))?$/i;function G(e,t){return e-t}function J(e,t){var r,n;return(r=Number(e.toFixed(t)))<e?n=r+1/Math.pow(10,t):(n=r,r-=1/Math.pow(10,t)),[r=Number(r.toFixed(t)),n=Number(n.toFixed(t))]}function Q(e,t,r,n,a){var i=X(e,t,r,n),l=null==i.previous||i.previous<=a,s=null==i.next||i.next<=a;return l&&s||i.previous+i.next<=2*a}function K(e){var t=String(e),r=t.match(W);if(r&&r[1])return{integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){var n=t.split("e"),a=n[0],i=n[1];if(a&&i){var l=Number(a),s=Number(i),o=s>0;o||(s=Math.abs(s));var c=K(l);return o?(c.integer+=s,s>c.fractional?c.fractional=0:c.fractional-=s):(c.fractional+=s,s>c.integer?c.integer=1:c.integer-=s),c}}return{integer:0,fractional:0}}function X(e,t,r,n){var a={previous:null,next:null};if(null!=r){var i=e-r,l=t-r-i;a.previous=Math.floor(Math.abs(100*l/i))}if(null!=n){var s=n-e,o=n-t-s;a.next=Math.floor(Math.abs(100*o/s))}return a}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.slice(0),n=t.tolerance,a=void 0===n?2:n,i=t.strictBounds,l=void 0!==i&&i,s=t.indexes,o=void 0===s?r.map((function(e,t){return t})):s;o.sort(G);for(var c=0;c<o.length;c++){var u=o[c],d=r[u],y=0===u?null:r[u-1],h=u===r.length-1?null:r[u+1],f=K(d).fractional;if(f){for(var b=void 0,p=0,v=!1;p<=f&&!v;){var m=J(d,p);v=Q(d,b=l&&0===c?m[1]:m[0],y,h,a),p++}v&&(r[u]=b)}}return r}var Z={maximumFractionDigits:20};var $=Object(U.a)("short-date");function ee(e,t,r,n){var a="";0===t?a="".concat("<"," "):t===r&&(a="".concat(">"," "));var i;return a+(n?Object(U.b)(e,$):(i=e,Object(q.b)(i,Z)))}var te=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="],re=new L.a([64,64,64]);function ne(e,t){var r=[],n=e.length-1;return 5===e.length?r.push(0,2,4):r.push(0,n),e.map((function(e,a){return r.indexOf(a)>-1?ee(e,a,n,t):null}))}function ae(e,t,r){return ie.apply(this,arguments)}function ie(){return(ie=Object(w.a)(_.a.mark((function e(t,n,a){var i,l,s,o,c,u,d;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!1,l=[],s=[],t.stops&&(o=t.stops,l=o.map((function(e){return e.value})),(i=o.some((function(e){return!!e.label})))&&(s=o.map((function(e){return e.label})))),c=l[0],u=l[l.length-1],null!=c||null!=u){e.next=5;break}return e.abrupt("return",null);case 5:return d=i?null:ne(l,a),e.next=8,Promise.all(l.map(function(){var e=Object(w.a)(_.a.mark((function e(a,l){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a,"opacity"!==t.type){e.next=7;break}return e.next=4,le(a,t,n);case 4:e.t1=e.sent,e.next=10;break;case 7:return e.next=9,Promise.resolve().then(r.bind(null,997));case 9:e.t1=e.sent.getColor(t,a);case 10:return e.t2=e.t1,e.t3=i?s[l]:d[l],e.abrupt("return",{value:e.t0,color:e.t2,label:e.t3});case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",e.sent.reverse());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,t){return se.apply(this,arguments)}function se(){return(se=Object(w.a)(_.a.mark((function e(t,n){var a,i,l,s=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:re,i=new L.a(a),e.next=4,Promise.resolve().then(r.bind(null,997));case 4:return l=e.sent.getOpacity(n,t),e.abrupt("return",(null!=l&&(i.a=l),i));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){var t,r=[],n=[];r=e.map((function(e){return e.value})),(t=e.some((function(e){return!!e.label})))&&(n=e.map((function(e){return e.label})));var a=r[0],i=r[r.length-1];if(null==a&&null==i)return null;var l=t?null:ne(r,!1);return r.map((function(r,a){return{value:r,color:ce(r,e),label:t?n[a]:l[a]}})).reverse()}function ce(e,t){var r=function(e,t){var r=0,n=t.length-1;return t.some((function(t,a){return e<t.value?(n=a,!0):(r=a,!1)})),{startIndex:r,endIndex:n,weight:(e-t[r].value)/(t[n].value-t[r].value)}}(e,t),n=r.startIndex,a=r.endIndex,i=r.weight;if(n===a)return t[n].color;var l=L.a.blendColors(t[n].color,t[a].color,i);return new L.a(l)}var ue=r(1382);function de(e){var t=e.colorStops,r=t.length-1;if(t&&t[0]){var n=t[r];n&&1!==n.ratio&&((t=t.slice(0)).push(new ue.a({ratio:1,color:n.color})),r++)}return t.map((function(e,t){var n="";return 0===t?n="low":t===r&&(n="high"),{color:e.color,label:n,ratio:e.ratio}})).reverse()}r(660);var ye=r(1047),he=r(1265),fe={HH:315,HL:45,LL:135,LH:225},be={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function pe(e){if(e){var t=e.type;if(t.indexOf("3d")>-1)return Object(he.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){var r=Object(ye.d)(e);return r&&r.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){var n=Object(ye.d)(e);return n&&n.color}return Object(ye.b)(e)}}function ve(e,t){var r=t.HH.label,n=t.LL.label,a=t.HL.label,i=t.LH.label;switch(e){case"HH":return{top:r,bottom:n,left:a,right:i};case"HL":return{top:a,bottom:i,left:n,right:r};case"LL":return{top:n,bottom:r,left:i,right:a};case"LH":return{top:i,bottom:a,left:r,right:n};default:return{top:r,bottom:n,left:a,right:i}}}function me(e){var t=e.focus,r=e.infos,n=e.numClasses,a=be[n],i={};r.forEach((function(e){i[e.value]={label:e.label,fill:pe(e.symbol)}}));for(var l=[],s=0;s<n;s++){for(var o=[],c=0;c<n;c++){var u=i[a[s][c]];o.push(u.fill)}l.push(o)}return{type:"relationship-ramp",numClasses:n,focus:t,colors:l,labels:ve(t,i),rotation:ge(t)}}function ge(e){var t=fe[e];return e&&null==t&&(t=fe.HH),t||0}var Oe=r(654),_e=[255,255,255],je=[200,200,200],we=[128,128,128];function Le(e,t){var r=e.length-1;return e.map((function(e,n){return ee(e,n,r,t)}))}function ke(e,t,r,n,a,i){return xe.apply(this,arguments)}function xe(){return(xe=Object(w.a)(_.a.mark((function e(t,r,n,a,i,l){var s,o,c,u,d,y,h,f,b,p,v,m,g,O,j,L,k,x,S,I;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r.legendOptions,u=c&&c.customValues,d=Ae(t,n),y=!!d,h=!!u,f=null!=r.minSize&&null!=r.maxSize,b=r.stops&&r.stops.length>1,p=!!r.target,y&&(h||f||b&&!p)){e.next=3;break}return e.abrupt("return");case 3:if(v=Object(P.h)(d),m=null,g=null,O=null,!v||b){e.next=9;break}e.t0=Y([r.minDataValue,r.maxDataValue]),e.next=15;break;case 9:if(e.t1=u,e.t1){e.next=14;break}return e.next=13,Ve(r,d,a,i);case 13:e.t1=e.sent;case 14:e.t0=e.t1;case 15:if(g=e.t0,j=null==t?void 0:t.authoringInfo,L="univariate-color-size"===(null==j?void 0:j.type),k=L&&"above-and-below"===(null==j?void 0:j.univariateTheme),!g&&b&&(g=r.stops.map((function(e){return e.value})),(m=r.stops.some((function(e){return!!e.label})))&&(O=r.stops.map((function(e){return e.label})))),v&&(null==(s=g)?void 0:s.length)>2&&!k&&(g=[g[0],g[g.length-1]]),g){e.next=19;break}return e.abrupt("return",null);case 19:return L&&5!==(null==(o=g)?void 0:o.length)&&(g=Me({minSize:g[0],maxSize:g[g.length-1]})),x=v?Se(t,g):null,S=Object(P.g)(d),I=m?null:Le(g,l),e.next=23,Promise.all(g.map(function(){var e=Object(w.a)(_.a.mark((function e(n,l){var s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v){e.next=4;break}e.t0=x[l],e.next=7;break;case 4:return e.next=6,De(r,d,n,a,i);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",{value:n,symbol:Pe(k&&"class-breaks"===t.type?Ie(t,l):d,s),label:m?O[l]:I[l],size:s,outlineSize:S});case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 23:return e.abrupt("return",e.sent.reverse());case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e,t){var r=null==e?void 0:e.authoringInfo,n="univariate-color-size"===(null==r?void 0:r.type),a=[12,30];if(n){var i=t[0],l=t[t.length-1];a=t.map((function(e){return 12+(e-i)/(l-i)*18}))}return n&&"below"===(null==r?void 0:r.univariateTheme)&&a.reverse(),a}function Ie(e,t){var r=e.classBreakInfos,n=r.length,a=n<2||!(t>=2)?r[0].symbol.clone():r[n-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(a.type.indexOf("3d")>-1?Ee(a):Ce(a)),a}function Ae(e,t){var r=null,n=null;if("simple"===e.type)r=e.symbol;else if("class-breaks"===e.type){var a=e.classBreakInfos;r=a&&a[0]&&a[0].symbol,n=a.length>1}else if("unique-value"===e.type){var i=e.uniqueValueInfos;r=i&&i[0]&&i[0].symbol,n=i.length>1}return!r||function(e){if(e)return Object(S.c)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):-1!==e.type.indexOf("fill");return!1}(r)?null:(r=r.clone(),(t||n)&&(r.type.indexOf("3d")>-1?Ee(r):Ce(r)),r)}function Ee(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:we}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:je}:(e.material={color:_e},e.outline={color:we,size:1.5})}))}function Ce(e){"cim"===e.type?Object(D.a)(e,new L.a(je)):-1!==e.type.indexOf("line")?e.color=we:(e.color=_e,"simple-marker"===e.type&&(e.outline={color:we,width:1.5}))}function Ve(e,t,r,n){return ze.apply(this,arguments)}function ze(){return(ze=Object(w.a)(_.a.mark((function e(t,n,a,i){var l,s,o,c,u;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(null,997));case 2:if(l=e.sent.getSizeRangeAtScale(t,a,i),s=l&&Me(l),l||s){e.next=6;break}return e.abrupt("return");case 6:o=Y(o=s.map((function(e){return Re(e,t,l)}))),c=1;case 9:if(!(c<o.length-1)){e.next=17;break}return e.next=12,Fe(t,n,o[c],o[c-1],a,i);case 12:(u=e.sent)&&(o[c]=u[0],s[c]=u[1]);case 14:c++,e.next=9;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e){for(var t=e.minSize,r=(e.maxSize-t)/4,n=[],a=0;a<5;a++)n.push(t+r*a);return n}function Re(e,t,r){var n=r.minSize,a=r.maxSize,i=t.minDataValue,l=t.maxDataValue;return e<=n?i:e>=a?l:(e-n)/(a-n)*(l-i)+i}function Fe(e,t,r,n,a,i){return Te.apply(this,arguments)}function Te(){return(Te=Object(w.a)(_.a.mark((function e(t,r,n,a,i,l){var s,o,c,u,d,y,h,f,b,p,v,m,g,O,j,w,L,k,x,S,I,A,E;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,De(t,r,n,i,l);case 2:return s=e.sent,e.next=5,De(t,r,a,i,l);case 5:o=e.sent,c=K(n),u=c.fractional,d=20,y=c.integer,h=null,f=null,n>0&&n<1&&(h=Math.pow(10,u),y=K(n*=h).integer),b=y-1;case 12:if(!(b>=0)){e.next=38;break}return p=Math.pow(10,b),v=Math.floor(n/p)*p,m=Math.ceil(n/p)*p,null!=h&&(v/=h,m/=h),O=Y([v,g=(v+m)/2,m],{indexes:[1]}),j=Object(Oe.a)(O,2),g=j[1],e.next=22,De(t,r,v,i,l);case 22:return w=e.sent,e.next=25,De(t,r,m,i,l);case 25:return L=e.sent,e.next=28,De(t,r,g,i,l);case 28:if(k=e.sent,x=X(s,w,o,null),S=X(s,L,o,null),I=X(s,k,o,null),A=x.previous<=d,E=S.previous<=d,A&&E&&(x.previous<=S.previous?(A=!0,E=!1):(E=!0,A=!1)),A?f=[v,w]:E?f=[m,L]:I.previous<=d&&(f=[g,k]),!f){e.next=35;break}return e.abrupt("break",38);case 35:b--,e.next=12;break;case 38:return e.abrupt("return",f);case 39:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e,t,r,n,a){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(w.a)(_.a.mark((function e(t,n,a,i,l){var s,o;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(null,997));case 2:return s=e.sent,o=s.getSize,e.abrupt("return",o(t,a,{scale:i,view:l,shape:"simple-marker"===n.type?n.style:null}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e,t){var r=e.clone();if(Object(S.c)(r))Object(P.h)(r)||r.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(r))r.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(r)){var n=r.width,a=r.height;r.height=t,r.width=t*(n/a)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(r)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(r)&&r.font&&(r.font.size=t):r.width=t;return r}var Be=r(931),He=r(908),Ue=h.a.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),qe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,We=new I.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Ge={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Je=new Be.a({size:6,outline:{color:[128,128,128,.5],width:.5}}),Qe=new He.a({style:"solid"});function Ke(e){return"vector-field"===e.type}function Xe(e){return"raster-colormap"===e.type}function Ye(e){return"raster-stretch"===e.type}function Ze(e){return"raster-shaded-relief"===e.type}function $e(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function et(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function tt(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function rt(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function nt(e){return at(e)||it(e)||lt(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function at(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function it(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function lt(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function st(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function ot(e,t){return $e(e)||et(e)||tt(e)||rt(e)||st(e)?"2d"===t.type||F(e):Ye(e)||Xe(e)||Ze(e)||at(e)||it(e)||lt(e)||Ke(e)}function ct(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function ut(e){return"esri.layers.WMSLayer"===e.declaredClass}function dt(e){return"esri.layers.WMTSLayer"===e.declaredClass}function yt(e){return"esri.layers.MapImageLayer"===e.declaredClass}function ht(e){return"esri.layers.TileLayer"===e.declaredClass}function ft(e){return"esri.layers.FeatureLayer"===e.declaredClass}function bt(e){return"esri.layers.ImageryLayer"===e.declaredClass}function pt(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function vt(e){return"esri.layers.WCSLayer"===e.declaredClass}function mt(e){return"stretch-ramp"===e.type}function gt(e){var t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)}function Ot(e){var t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}var _t=new Be.a({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),jt={},wt=function(e){Object(l.a)(o,e);var t=Object(s.a)(o);function o(e){var r;return Object(a.a)(this,o),(r=t.call(this,e))._handles=new c.a,r._hasColorRamp=!1,r._hasOpacityRamp=!1,r._hasSizeRamp=!1,r._webStyleSymbolCache=new Map,r._dotDensityUrlCache=new Map,r._scaleDrivenSizeVariable=null,r._hasClusterSizeVariable=!1,r.children=new m.a,r.layerView=null,r.layer=null,r.legendElements=[],r.parent=null,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.sublayerIds=[],r.title=null,r.view=null,r}return Object(i.a)(o,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([Object(u.b)(this,"children","change",(function(r){var n=r.added,a=r.removed,i=e._handles;n.map((function(e){var r="activeLayerInfo-ready-watcher-".concat(e.layer.uid);i.add(Object(u.a)(e,"ready",t),r)})),a.forEach((function(e){return i.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(jt={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(jt=null)}},{key:"opacity",get:function(){var e,t=this.layer.opacity,r=null==(e=this.parent)?void 0:e.opacity,n=this.layer.parent,a=n&&"uid"in n?this._getParentLayerOpacity(n):null;return null!=r?r*t:null!=a?a*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this,t=this.layer;if(null===t)return!1;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type)return!0;if("renderer"in t&&t.renderer){if("dot-density"===t.renderer.type)return!0;var r=t.get("renderer.valueExpression");if(qe.test(r))return!0;var n=t.get("renderer.visualVariables");if(n)return n.some((function(t){return e._isScaleDrivenSizeVariable(t)}))}return this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=Object(w.a)(_.a.mark((function e(t){var r,n,a=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map((function(e){if(ft(e))return a._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,r=t&&t.drawingInfo,n=r&&Object(R.a)(r.renderer),i=We.read(t.geometryType);return n?a._getRendererLegendElements(n,{title:e.name,geometryType:i}):(Ue.warn("drawingInfo not available!"),null)}return null})),e.prev=1,n=[],e.next=5,Object(E.j)(r).then((function(e){e.forEach((function(e){var t=e.value;return t&&n.push.apply(n,Object(j.a)(t))}))}));case 5:this.legendElements=n,this.notifyChange("ready"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),Ue.warn("error while building legend for layer!",e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=Object(w.a)(_.a.mark((function e(t){var r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getRendererLegendElements(t);case 3:r=e.sent,this.legendElements=r,this.notifyChange("ready"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Ue.warn("error while building legend for layer!",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=Object(w.a)(_.a.mark((function e(){var t,r,n,a,i,l=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!dt(t=this.layer)){e.next=5;break}this._constructLegendElementsForWMTSlayer(),e.next=25;break;case 5:if(!ut(t)){e.next=10;break}return e.next=8,this._constructLegendElementsForWMSSublayers();case 8:e.next=25;break;case 10:if(!ct(t)){e.next=15;break}return e.next=13,this._constructLegendElementsForBuildingSceneLayer();case 13:e.next=25;break;case 15:if(!(yt(t)||ht(t)||ct(t))){e.next=20;break}return e.next=18,this._constructLegendElementsForSublayers();case 18:e.next=25;break;case 20:return this._handles.remove("imageryLayers-watcher"),r="default",bt(t)&&(r=((null==(i=t)||null==(n=i.renderingRule)?void 0:n.functionName)||"default")+"_"+(null!=(a=t.bandIds)&&a.length?t.bandIds.join(""):"###")),e.next=25,this._getLegendLayers("".concat(t.uid,"-").concat(r)).then(function(){var e=Object(w.a)(_.a.mark((function e(r){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.legendElements=[],l.notifyChange("ready"),n=r.map(function(){var e=Object(w.a)(_.a.mark((function e(r){var n,a;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(bt(t)||pt(t))&&(n=t.watch(["renderingRule","bandIds"],(function(){return Object(E.i)(Object(w.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(jt.default=null,!t.renderer){e.next=6;break}return e.next=4,l.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,l.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),l._handles.add(n,"imageryLayers-watcher")),(a=l._generateSymbolTableElementForLegendLayer(r))&&a.infos.length&&(bt(t)&&(a.title=t.title),l.legendElements.push(a)),l.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Object(E.j)(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){Ue.warn("Request to server for legend has failed!",e)}));case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,r=e.parent;return r&&"uid"in r&&(t=this._getParentLayerOpacity(r)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,r=t.minSize,n=t.maxSize;return"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):!!t.expression||qe.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var r=e.parent;if(!1===e.loaded&&r&&yt(r)&&"source"in e&&e.source&&"map-layer"===e.source.type){var n,a=Object(g.a)(r.sourceJSON.layers);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}}catch(l){a.e(l)}finally{a.f()}}return!1}},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add(Object(u.d)(this.layer,"activeLayer",(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var r=null;t.styles.some((function(e){return t.styleId===e.id&&(r=e.legendUrl,!0)})),r&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:r,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=Object(w.a)(_.a.mark((function e(){var t,r,a=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,r=null,(t.customParameters||t.customLayerParameters)&&(r=Object(n.a)(Object(n.a)({},t.customParameters),t.customLayerParameters)),this._handles.add(Object(u.d)(this.layer,"sublayers",(function(){return a._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,r);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r){var n,a,i,l,s,o,c,u=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this._handles.add(t.on("change",(function(){return u._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),a=t.toArray(),i=Object(g.a)(a),e.prev=4,i.s();case 6:if((l=i.n()).done){e.next=16;break}if(s=l.value,o=s.watch(["title","visible","legendEnabled"],(function(){return u._constructLegendElementsForWMSSublayers()})),this._handles.add(o,"wms-sublayers-watcher"),!(!this.respectLayerVisibility||s.visible&&s.legendEnabled)){e.next=14;break}return e.next=12,this._generateSymbolTableElementForWMSSublayer(s,r);case 12:(c=e.sent)&&c.infos.length&&n.unshift(c);case 14:e.next=6;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),i.e(e.t0);case 21:return e.prev=21,i.f(),e.finish(21);case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}}),e,this,[[4,18,21,24]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,r);case 3:return n=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:n});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r){var n,a,i,l,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return i={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},r&&(a+="?"+Object(V.E)(r)),l=null,s=null==(n=t.layer)?void 0:n.opacity,e.prev=7,e.next=10,Object(x.default)(a,{responseType:"image"});case 10:(l=e.sent.data)&&(l.style.opacity=s),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(i.infos.push({src:a,preview:l,opacity:s}),i));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var r=jt&&jt[e];return r?Promise.resolve(r):this._legendRequest(t).then((function(t){var r=t.layers;return jt[e]=r,r}))}},{key:"_legendRequest",value:function(e){var t=this.layer,r={f:"json",dynamicLayers:e};if(bt(t)){var a=t.exportImageServiceParameters.renderingRule;if(a&&(r.renderingRule=JSON.stringify(a.toJSON())),t.bandIds&&(r.bandIds=t.bandIds.join()),t.raster||t.viewId){var i=t.raster,l=t.viewId;r=Object(n.a)({raster:i,viewId:l},r)}}var s=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var o=s.indexOf("?");o>-1?s=s.substring(0,o)+"/legend"+s.substring(o):s+="/legend"}else{var c=s.toLowerCase().indexOf("/rest/"),u=s.substring(0,c)+s.substring(c+5,s.length);s="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(u)+"&returnbytes=true"}return Object(x.default)(s,{query:r}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=Object(w.a)(_.a.mark((function e(){var t,r=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add(Object(u.d)(t,"sublayers",(function(){return r._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Ue.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r){var n,a,i,l,s,o,c,u,d,y,h,f=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this._handles.add(t.on("change",(function(){return f._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),a=t.toArray(),i=Object(g.a)(a),e.prev=4,i.s();case 6:if((l=i.n()).done){e.next=30;break}if(s=l.value,o=s.watch(["renderer","opacity","title","visible"],(function(){return f._constructLegendElementsForBuildingSceneLayer()})),this._handles.add(o,"sublayers-watcher"),this.respectLayerVisibility&&!s.visible){e.next=28;break}if(c=s&&null!=s.opacity?s.opacity:null,u=null!=c?c*r:r,"building-group"!==s.type){e.next=19;break}return y={type:"symbol-table",title:s.title,infos:[]},e.next=15,this._generateLegendElementsForBuildingSublayers(s.sublayers,u);case 15:h=e.sent,(d=y.infos).push.apply(d,Object(j.a)(h)),n=[y].concat(Object(j.a)(n)),e.next=28;break;case 19:if(!s.renderer){e.next=28;break}return e.t0=[],e.t1=j.a,e.next=24,this._getRendererLegendElements(s.renderer,{title:s.title,opacity:u,sublayer:s});case 24:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=Object(j.a)(n),n=e.t0.concat.call(e.t0,e.t3,e.t4);case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t5=e.catch(4),i.e(e.t5);case 35:return e.prev=35,i.f(),e.finish(35);case 38:return e.abrupt("return",n.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 39:case"end":return e.stop()}}),e,this,[[4,32,35,38]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=Object(w.a)(_.a.mark((function e(){var t,r=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add(Object(u.d)(t,"sublayers",(function(){return r._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Ue.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r,n){var a,i,l,s,o,c,u,d,y,h,f=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.layer,i=[],this._handles.add(t.on("change",(function(){return f._constructLegendElementsForSublayers()})),"sublayers-watcher"),l=t.toArray(),!n&&this.sublayerIds&&this.sublayerIds.length&&(l=this.sublayerIds.map((function(e){return a.findSublayerById(e)})).filter(Boolean)),s=Object(g.a)(l),e.prev=6,s.s();case 8:if((o=s.n()).done){e.next=32;break}if(c=o.value,u=c.watch("renderer, opacity, title, visible, legendEnabled",(function(){return f._constructLegendElementsForSublayers()})),this._handles.add(u,"sublayers-watcher"),this.respectLayerVisibility&&!(c.visible&&c.legendEnabled&&this._isSublayerInScale(c))){e.next=30;break}if(d=c&&null!=c.opacity?c.opacity:null,y=null!=d?d*r:r,!(c.renderer&&!c.sublayers&&c.originIdOf("renderer")>2)){e.next=26;break}return e.next=16,c.load();case 16:return e.t0=[],e.t1=j.a,e.next=20,this._getRendererLegendElements(c.renderer,{title:c.title,opacity:y,sublayer:c});case 20:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=Object(j.a)(i),i=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=30;break;case 26:return e.next=28,this._generateSymbolTableElementForSublayer(c,y,n);case 28:(h=e.sent)&&i.unshift(h);case 30:e.next=8;break;case 32:e.next=37;break;case 34:e.prev=34,e.t5=e.catch(6),s.e(e.t5);case 37:return e.prev=37,s.f(),e.finish(37);case 40:return e.abrupt("return",i.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 41:case"end":return e.stop()}}),e,this,[[6,34,37,40]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r,n){var a,i,l,s,o;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=8;break}return n=new Map,a=new z.a({layer:this.layer}),i=a.hasDynamicLayers?a.dynamicLayers:null,a.destroy(),l=i||"".concat(this.layer.uid,"-").concat(t.id,"-default"),e.next=7,this._getLegendLayers(l,i);case 7:e.sent.forEach((function(e){return n.set(e.layerId,e)}));case 8:if((s=n.get(t.id))||!t.sublayers){e.next=14;break}return e.next=12,this._generateLegendElementsForSublayers(t.sublayers,r,n);case 12:return o=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:o});case 14:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(s,t,r));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,r){var n,a=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var i=null==t?void 0:t.renderer,l=(null==t?void 0:t.title)||e.layerName;if(i&&(!t||(null==t?void 0:t.originIdOf("renderer"))>2)){var s=(null==t?void 0:t.title)||this._getRendererTitle(i,t);s&&(l&&"string"!=typeof s&&"title"in s&&(s.title=l),l=s)}var o={type:"symbol-table",title:l,legendType:e.legendType?e.legendType:null,infos:[]},c=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null==(n=e.legendGroups)?void 0:n.length)>0?e.legendGroups.forEach((function(t){var n,i={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:a._generateSymbolTableElementInfosForLegendLayer(c.filter((function(e){return e.groupId===t.id})),e.layerId,r)};(null==(n=i.infos)?void 0:n.length)>0&&o.infos.push(i)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(c,e.layerId,r),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,r){var n=this;return e.map((function(e){var a=e.url;if(e.imageData&&e.imageData.length>0)a="data:image/png;base64,".concat(e.imageData);else{if(0===a.indexOf("http"))return null;a=Object(k.a)("".concat(n.layer.url,"/").concat(t,"/images/").concat(a))}return{label:e.label,src:a,opacity:null==r?n.opacity:r,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,r=e.maxScale||0;return!(t>0&&t<this.scale||r>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var r=t||this.layer,n=null,a=null,i=!0;return!r.minScale&&0!==r.minScale||!r.maxScale&&0!==r.maxScale?(0===e.minScale&&r.tileInfo&&(n=r.tileInfo.lods[0].scale),0===e.maxScale&&r.tileInfo&&(a=r.tileInfo.lods[r.tileInfo.lods.length-1].scale)):(n=Math.min(r.minScale,e.minScale)||r.minScale||e.minScale,a=Math.max(r.maxScale,e.maxScale)),(n>0&&n<this.scale||a>this.scale)&&(i=!1),i}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var r=t.renderer,n=e.some((function(e){return e.values})),a=null,i=null;return n&&e.some((function(e,t){return e.values||(a=t,(i=e).label||(i.label="others")),null!=i})),r?"unique-value"===r.type?i&&(e.splice(a,1),e.push(i)):"class-breaks"===r.type&&(i&&e.splice(a,1),e.reverse(),i&&e.push(i)):i&&(e.splice(a,1),e.push(i)),e}},{key:"_getRendererLegendElements",value:function(){var e=Object(w.a)(_.a.mark((function e(t){var r,n=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",ot(t,this.view)?nt(t)?this._constructPointCloudRendererLegendElements(t,r):st(t)?this._constructDotDensityRendererLegendElements(t):this._constructRendererLegendElements(t,r):(Ue.warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.title,a=[],i=null,l=null;if(at(e))i={type:"symbol-table",title:n||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){i.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(Je,e.color)})}));else if(it(e)){var s=e.stops,o=null;if(s.length&&(1===s.length&&(o=s[0].color),!o)){var c=s[0].value,u=s[s.length-1].value;null!=c&&null!=u&&(o=ce(c+(u-c)/2,s))}i={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Je,o||Je.color)}]};var d=oe(e.stops);l={type:"color-ramp",title:n||this._getPointCloudRendererTitle(e),infos:d,preview:Object(N.b)(d.map((function(e){return e.color})))}}else lt(e)&&(i={type:"symbol-table",title:n||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){i.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(Je,e.color)})})));i&&i.infos.length&&a.push(i),l&&l.infos.length&&a.push(l);var y=a.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(r){return t._getSymbolPreview(r,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return Object(E.j)(y).then((function(){return a}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var r=e.backgroundColor,n=e.outline,a=e.dotSize+"-"+t+"-"+r+"-"+(n&&JSON.stringify(n.toJSON())),i=this._dotDensityUrlCache,l=i.has(a)?i.get(a):Object(N.c)(e,t);return i.set(a,l),{opacity:1,src:l.src,preview:l,width:l.width,height:l.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,r=e.calculateDotValue(this.view.scale),n=e.legendOptions&&e.legendOptions.unit,a={type:"symbol-table",title:{value:r&&Math.round(r),unit:n||""},infos:[]};return e.attributes.forEach((function(r){var n=t._getElementInfoForDotDensity(e,r.color);n.label=r.label||r.valueExpressionTitle||r.field,a.infos.push(n)})),Promise.resolve([a])}},{key:"_constructRendererLegendElements",value:function(){var e=Object(w.a)(_.a.mark((function e(t){var r,n,a,i,l,s,o,c,u,d,y,h,f,b,p,v,m,g,O,j,w,L,k,x,S,I,C,V,z,M,R,F,T,D,P,B,H,U,q,W,G,J,Q,K,X,Y,Z,$,ee,te,re,ne,ae,ie=this,le=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=le.length>1&&void 0!==le[1]?le[1]:{},n=r.title,a=r.sublayer,i=a||this.layer,e.next=4,this._loadRenderer(t);case 4:return l=e.sent,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=8,this._getVisualVariableLegendElements(l,i);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:if(s=e.t0,o={type:"symbol-table",title:n||this._getRendererTitle(l,i),infos:[]},c=null,u=!1,d=new Set,!gt(l)){e.next=21;break}y=n,h=Ot(l)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",f=s.findIndex((function(e){return"color-ramp"===e.type})),b=s.splice(f,1)[0],p=s.findIndex((function(e){return"size-ramp"===e.type})),v=s.splice(p,1)[0],m=[],b&&(y=b.title,m.push(b)),v&&(y=v.title,m.push(v)),m.length>0&&s.push({type:h,title:y,infos:m}),e.next=82;break;case 21:if(!rt(l)){e.next=26;break}g=de(l),s.push({type:"heatmap-ramp",title:n,infos:g,preview:Object(N.b)(g.map((function(e){return e.color})))}),e.next=82;break;case 26:if(!tt(l)){e.next=32;break}if((O=l&&l.authoringInfo)&&"relationship"===O.type){if(j=O.focus,w=O.numClasses,L=O.field1,k=O.field2,w&&L&&k){for(x=[L,k],S=ge(j)||0,I=0,C=x;I<C.length;I++)V=C[I],z=V.field,M=V.normalizationField,R=V.label,F=R||{field:this._getFieldAlias(z,i),normField:M&&this._getFieldAlias(M,i)},(T=_t.clone()).angle=S,o.infos.push({label:F,symbol:T}),d.add(T),S+=90;D=me({focus:j,numClasses:w,infos:l.uniqueValueInfos}),s.unshift(D)}}else P=l.field,l.uniqueValueInfos.forEach((function(e){e.symbol&&o.infos.push({label:e.label||ie._getDomainName(P,e.value,i)||e.value,value:e.value,symbol:e.symbol})}));l.defaultSymbol&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),u=!0),e.next=82;break;case 32:if(!et(l)){e.next=37;break}(!(c=this._isUnclassedRenderer(l))||!this._hasSizeRamp)&&(l.classBreakInfos.forEach((function(e){e.symbol&&o.infos.unshift({label:e.label||(c?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),c&&(o.title=null),this._updateInfosforClassedSizeRenderer(l,o.infos)),l.defaultSymbol&&!c&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),u=!0),e.next=82;break;case 37:if(!Ye(l)){e.next=64;break}if(!pt(this.layer)||"Map"!==(null==(B=this.layer)||null==(H=B.raster)?void 0:H.tileType)){e.next=42;break}this._getServerSideLegend(),e.next=62;break;case 42:if(!pt(this.layer)&&!vt(this.layer)){e.next=47;break}mt(U=this._constructTileImageryStretchRendererElements(l))?s.push(U):o.infos=U,e.next=62;break;case 47:if(q=this.layer,l.statistics&&l.statistics.length?(W=null!=l.statistics[0].min?l.statistics[0].min:l.statistics[0][0],G=null!=l.statistics[0].max?l.statistics[0].max:l.statistics[0][1]):(W=null==(J=l)?void 0:J.outputMin,G=null==(Q=l)?void 0:Q.outputMax),K=[],e.t1=A.p,!q.renderingRule){e.next=57;break}return e.next=54,q.generateRasterInfo(q.renderingRule);case 54:e.t2=e.sent,e.next=58;break;case 57:e.t2=q.serviceRasterInfo;case 58:e.t3=e.t2,X=(0,e.t1)(e.t3),Y=X.keyProperties.BandProperties,1===X.bandCount?(W=null!=W?W:X.statistics&&X.statistics[0].min,G=null!=G?G:X.statistics&&X.statistics[0].max,W||G?s.push(this._getStretchLegendElements(l,{min:W,max:G})):this._getServerSideLegend()):q.bandIds&&1===q.bandIds.length?(W=null!=W?W:X.statistics&&X.statistics[q.bandIds[0]].min,G=null!=G?G:X.statistics&&X.statistics[q.bandIds[0]].max,W||G?s.push(this._getStretchLegendElements(l,{min:W,max:G})):this._getServerSideLegend()):X.bandCount>=3?Y&&Y.length>=X.bandCount?q.bandIds&&3===q.bandIds.length?(K=q.bandIds.map((function(e){return Y[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(K)):"lerc"===q.format?(K=[0,1,2].map((function(e){return Y[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(K)):this._getServerSideLegend():"lerc"===q.format?(K=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(K)):this._getServerSideLegend():this._getServerSideLegend();case 62:e.next=82;break;case 64:if(!Xe(l)){e.next=68;break}l.colormapInfos.forEach((function(e){o.infos.push({label:e.label,value:e.value,symbol:ie._getAppliedCloneSymbol(Qe,e.color)})})),e.next=82;break;case 68:if(!$e(l)){e.next=81;break}Z=l.symbol,e.t4=r.geometryType,e.next="point"===e.t4?73:"polyline"===e.t4?75:"polygon"===e.t4?77:78;break;case 73:return Z="pointSymbol"in i&&i.pointSymbol,e.abrupt("break",78);case 75:return Z="lineSymbol"in i&&i.lineSymbol,e.abrupt("break",78);case 77:Z="polygonSymbol"in i&&i.polygonSymbol;case 78:l.symbol&&!this._hasSizeRamp&&o.infos.push({label:l.label,symbol:Z}),e.next=82;break;case 81:Ke(l)?(l.outputUnit&&(this.title="("+l.toJSON().outputUnit+")"),o.title=l.attributeField,null!=($=l.getClassBreakInfos())&&$.length?$.forEach((function(e){o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:l.attributeField,symbol:l.getDefaultSymbol()})):Ze(l)&&s.push(this._getStretchLegendElements(l,{min:0,max:255}));case 82:return!(ee=l.defaultSymbol)||u||$e(l)||c&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||s.push({type:"symbol-table",infos:[{label:l.defaultLabel||"others",symbol:ee}]}),o.infos.length&&s.unshift(o),te=null==r.opacity?this.opacity:r.opacity,re=this._isTallSymbol("visualVariables"in l&&l.visualVariables),ne=bt(this.layer)||pt(this.layer),ae=s.reduce((function(e,t){return e.concat(ie._getAllInfos(t))}),[]).filter((function(e){return!(!e||!e.symbol)})).map((function(e){return ie._getSymbolPreview(e,te,{applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:re,isSquareFill:ne}})})),l=null,e.next=88,Object(E.j)(ae);case 88:return e.abrupt("return",s);case 89:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,r=null==e?void 0:e.infos;return r?r.reduce((function(e,r){return e.concat(t._getAllInfos(r))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,r,n,a,i,l=this.layer,s=l.rasterInfo,o=s.bandCount||e.statistics.length,c=s.keyProperties&&s.keyProperties.BandProperties,u=null!=e&&null!=(t=e.statistics)&&t.length?e.statistics:null==s?void 0:s.statistics;if(u)n=void 0!==u[0].min?u[0].min:u[0][0],a=u[0].max||u[0][1];else{var d=Ge[l.rasterInfo.pixelType.toLowerCase()];n=d[0],a=d[1]}if(l.hasStandardTime()&&(n=l.getStandardTimeValue(n),a=l.getStandardTimeValue(a)),1===s.bandCount||1===(null==(r=l.bandIds)?void 0:r.length))return this._getStretchLegendElements(e,{min:n,max:a});function y(e){var t,r=(null!=l&&null!=(t=l.bandIds)&&t.length?l.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return r.length<3?r.push(r[1]):r.length>3&&r.splice(3),r}return i=c&&c.length>=o?y(c):y(),this._createSymbolTableElementMultiBand(i)}},{key:"_getStretchLegendElements",value:function(e,t){var r=function(e,t){var r,n,a=[];return e&&"multipart"===e.type?e.colorRamps.reverse().forEach((function(r,n){0===n?a.push({value:t.max,color:new L.a(r.toColor),label:"high"}):a.push({value:null,color:new L.a(r.toColor),label:""}),n===e.colorRamps.length-1?a.push({value:t.min,color:new L.a(r.fromColor),label:"low"}):a.push({value:null,color:new L.a(r.fromColor),label:""})})):(e&&"algorithmic"===e.type?(r=e.fromColor,n=e.toColor):(r=[0,0,0,1],n=[255,255,255,1]),a=[{value:t.max,color:new L.a(n),label:"high"},{value:t.min,color:new L.a(r),label:"low"}]),a}(e.colorRamp,t);return{type:"stretch-ramp",title:"",infos:r,preview:Object(N.b)(r.map((function(e){return e.color})))}}},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=[],r=["red","green","blue"];return e.forEach((function(e,n){t.push({label:{colorName:r[n],bandName:e},src:te[n],opacity:1})})),t}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var r=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,n=e.classBreakInfos.some((function(e){return Object(P.h)(e.symbol)}));if(r&&n){var a=e.classBreakInfos.length,i=18/(a>1?a-1:a);t.forEach((function(e,t){e.size=30-i*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,r=!1;if(e)for(var n=0;n<e.length&&(!t||!r);n++){var a=e[n];"size"===a.type&&("height"===a.axis&&(t=!0),"width-and-depth"===a.axis&&(r=!0))}return t&&r}},{key:"_getSymbolPreview",value:function(){var e=Object(w.a)(_.a.mark((function e(t,n,a){var i,l,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==t.size&&this._hasSizeRamp?Object(C.d)(22):t.size,!this._scaleDrivenSizeVariable||null==a||!a.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(r.bind(null,997));case 4:l=e.sent,s=l.getSize,i=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",Object(N.d)(t.symbol,{size:i,opacity:n,scale:!1,symbolConfig:null==a?void 0:a.symbolConfig}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_loadRenderer",value:function(){var e=Object(w.a)(_.a.mark((function e(t){var r,n,a,i,l,s,o,c,u,d,y,h,f,b=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],i=this.layer,t=t.clone(),this._hasClusterSizeVariable=!1,l="visualVariables"in t&&(null==(r=t.visualVariables)?void 0:r.some((function(e){return"size"===e.type&&"outline"!==e.target&&!qe.test(e.valueExpression)}))),t&&"visualVariables"in t&&!l&&"featureReduction"in i&&"cluster"===(null==(n=i.featureReduction)?void 0:n.type)&&(s=this.layerView._effectiveRenderer,(o=Object(A.p)(H(s,this.view)))&&("clusterMinSize"in(c=i.featureReduction)&&"clusterMaxSize"in c&&(u=c.clusterMinSize,d=c.clusterMaxSize,o.legendOptions=new T.a({showLegend:u!==d})),y=t.visualVariables||[],t.visualVariables=y.concat([o]),this._hasClusterSizeVariable=!0)),e.next=6,this._getMedianColor(t);case 6:return h=e.sent,(et(t)||tt(t))&&(f=(t.classBreakInfos||t.uniqueValueInfos).map((function(e){return b._fetchSymbol(e.symbol,h).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(a,f)),e.abrupt("return",(a.push(this._fetchSymbol(t.symbol||t.defaultSymbol,t.defaultSymbol?null:h).then((function(e){b._applySymbolToRenderer(t,e,$e(t))})).catch((function(){b._applySymbolToRenderer(t,null,$e(t))}))),Object(E.j)(a).then((function(){return t}))));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,r){r?e.symbol=t:e.defaultSymbol=t}},{key:"_getMedianColor",value:function(){var e=Object(w.a)(_.a.mark((function e(t){var n,a,i,l,s,o;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.visualVariables.find((function(e){return"color"===e.type}))){e.next=5;break}return e.abrupt("return",null);case 5:if(a=null,i=null,!n.stops){e.next=10;break}if(1!==n.stops.length){e.next=9;break}return e.abrupt("return",n.stops[0].color);case 9:a=n.stops[0].value,i=n.stops[n.stops.length-1].value;case 10:return l=a+(i-a)/2,e.next=13,Promise.resolve().then(r.bind(null,997));case 13:return s=e.sent,o=s.getColor,e.abrupt("return",o(n,l));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchSymbol",value:function(e,t){var r=this;if(!e)return Promise.reject();if("web-style"===e.type){var n=e.portal,a=n&&n.url,i=n&&n.user&&n.user.username,l=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+a+"-"+i,s=this._webStyleSymbolCache;return s.has(l)||("2d"===this.view.type?s.set(l,e.fetchCIMSymbol()):s.set(l,e.fetchSymbol())),s.get(l).then((function(e){return r._getAppliedCloneSymbol(e,t)})).catch((function(){return Ue.warn("Fetching web-style failed!"),Promise.reject()}))}return Promise.resolve(this._getAppliedCloneSymbol(e,t))}},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var r=e.clone(),n=t&&t.toRgba();return r.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(r,n):"cim"===r.type?Object(D.a)(r,t):r.color&&(r.color=new L.a(n||r.color)),r}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new L.a(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=Object(w.a)(_.a.mark((function e(t,r){var n,a,i,l,s,o,c,u,d,y,h,f,b=this;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:n=t.visualVariables,a=[],i=[],l=[],s=Object(g.a)(n);try{for(s.s();!(o=s.n()).done;)"color"===(c=o.value).type?a.push(c):"size"===c.type?i.push(c):"opacity"===c.type&&l.push(c)}catch(p){s.e(p)}finally{s.f()}return u=[].concat(a,i,l),0===a.length&&et(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(h=t.classBreakInfos[0],d=h&&h.symbol),0===a.length&&$e(t)&&(d=t.symbol),d&&(d.type.indexOf("3d")>-1?"water"===(f=d.symbolLayers.getItemAt(0)).type?Object(A.i)(f.color)&&(y=f.color):Object(A.i)(f.material)&&Object(A.i)(f.material.color)&&(y=f.material.color):d.url||(y=d.color)),e.next=10,Promise.all(u.map(function(){var e=Object(w.a)(_.a.mark((function e(n){var a,i,l,s,o,c;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.legendOptions&&!1===n.legendOptions.showLegend){e.next=39;break}if(a=b._getRampTitle(n,r),i=null,l="getField"in r&&r.getField&&r.getField(n.field),s=l&&Object(M.o)(l),"color"!==n.type){e.next=11;break}return e.next=7,ae(n,null,s);case 7:o=e.sent,i={type:"color-ramp",title:a,infos:o,preview:Object(N.b)(o.map((function(e){return e.color})))},b._hasColorRamp||(b._hasColorRamp=!(null==i.infos||!i.infos.length)),e.next=38;break;case 11:if("size"!==n.type||"outline"===n.target){e.next=33;break}if(!qe.test(n.valueExpression)){e.next=16;break}b._hasClusterSizeVariable||(b._scaleDrivenSizeVariable=n),e.next=31;break;case 16:return e.t0=b._hasClusterSizeVariable?b._getClusterTitle(n):a,e.t1=ke,e.t2=t,e.t3=n,e.next=22,b._getMedianColor(t);case 22:return e.t4=e.sent,e.t5=b.scale,e.t6=b.view.type,e.t7=s,e.next=28,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7);case 28:e.t8=e.sent,i={type:"size-ramp",title:e.t0,infos:e.t8},b._hasSizeRamp||(b._hasSizeRamp=!(null==i.infos||!i.infos.length));case 31:e.next=38;break;case 33:if("opacity"!==n.type){e.next=38;break}return e.next=36,ae(n,y,s);case 36:c=e.sent,i={type:"opacity-ramp",title:a,infos:c,preview:Object(N.b)(c.map((function(e){return e.color})))},b._hasOpacityRamp||(b._hasOpacityRamp=!(null==i.infos||!i.infos.length));case 38:return e.abrupt("return",i&&i.infos?i:null);case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,r){if(e&&"function"!=typeof e){var n="getField"in r&&r.getField&&r.getField(e),a=n&&"getFieldDomain"in r&&r.getFieldDomain?r.getFieldDomain(n.name):null;return a&&"coded-value"===a.type?a.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,r=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var n=t.featureReduction,a="popupTemplate"in n&&n.popupTemplate,i=a&&a.fieldInfos;if(i){var l,s=Object(g.a)(i);try{for(s.s();!(l=s.n()).done;){var o=l.value;if(o.fieldName===r)return"cluster_count"===r?o.label||{showCount:!0}:o.label}}catch(c){s.e(c)}finally{s.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var r=e.field,n=e.normalizationField,a=!1,i=!1,l=!1,s=null;r="function"==typeof r?null:r,n="function"==typeof n?null:n;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)s=o;else if(e.valueExpressionTitle)s=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var c=t.renderer.authoringInfo.visualVariables,u=0;u<c.length;u++){var d=c[u];if("color"===d.type){if("ratio"===d.style){a=!0;break}if("percent"===d.style){i=!0;break}if("percent-of-total"===d.style){l=!0;break}}}s={field:r&&this._getFieldAlias(r,t),normField:n&&this._getFieldAlias(n,t),ratio:a,ratioPercent:i,ratioPercentTotal:l}}return s}},{key:"_getRendererTitle",value:function(e,t){var r=e;if(r.legendOptions&&r.legendOptions.title)return r.legendOptions.title;if(r.valueExpressionTitle)return r.valueExpressionTitle;var n=r.field,a=null,i=null;et(r)&&(a=r.normalizationField,i="percent-of-total"===r.normalizationType),a="function"==typeof a?null:a;var l=null;return((n="function"==typeof n?null:n)||a)&&(l={field:n&&this._getFieldAlias(n,t),normField:a&&this._getFieldAlias(a,t),normByPct:i}),l}},{key:"_getFieldAlias",value:function(e,t){var r="popupTemplate"in t&&t.popupTemplate,n=r&&r.fieldInfos,a=null;n&&n.some((function(t){return e===t.fieldName&&(a=t,!0)}));var i=null;"getField"in t&&t.getField?i=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(i=t.fieldsIndex.get(e));var l=a||i,s=null;return l&&(s=a&&a.label||i&&i.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName),s}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,r=!1;return et(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(r=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),r}}]),o}(v.a);Object(o.a)([Object(f.b)()],wt.prototype,"children",void 0),Object(o.a)([Object(f.b)()],wt.prototype,"layerView",void 0),Object(o.a)([Object(f.b)()],wt.prototype,"layer",void 0),Object(o.a)([Object(f.b)()],wt.prototype,"legendElements",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],wt.prototype,"opacity",null),Object(o.a)([Object(f.b)()],wt.prototype,"parent",void 0),Object(o.a)([Object(f.b)({readOnly:!0,dependsOn:[]})],wt.prototype,"ready",null),Object(o.a)([Object(f.b)()],wt.prototype,"keepCacheOnDestroy",void 0),Object(o.a)([Object(f.b)()],wt.prototype,"respectLayerVisibility",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],wt.prototype,"scale",null),Object(o.a)([Object(f.b)()],wt.prototype,"sublayerIds",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],wt.prototype,"isScaleDriven",null),Object(o.a)([Object(f.b)()],wt.prototype,"title",void 0),Object(o.a)([Object(f.b)({readOnly:!0,dependsOn:["ready"],value:0})],wt.prototype,"version",null),Object(o.a)([Object(f.b)()],wt.prototype,"view",void 0);var Lt=wt=Object(o.a)([Object(b.a)("esri.widgets.Legend.support.ActiveLayerInfo")],wt),kt=r(822),xt="state",St="view",It="all-layer-views",At="legend-properties",Et=m.a.ofType(Lt),Ct=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Vt="view.basemapView.baseLayerViews",zt="view.groundView.layerViews",Mt="view.basemapView.referenceLayerViews",Rt=[Vt,zt,"view.layerViews",Mt],Ft=function(e){Object(l.a)(r,e);var t=Object(s.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._handles=new c.a,n._layerViewByLayerId={},n._layerInfosByLayerViewId={},n._activeLayerInfosByLayerViewId={},n._activeLayerInfosWithNoParent=new m.a,n.activeLayerInfos=new Et,n.basemapLegendVisible=!1,n.groundLegendVisible=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.layerInfos=[],n.view=null,n}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this._handles.add(Object(u.a)(this,"view",this._viewHandles),St),this._handles.add(Object(kt.c)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){this._handles.remove(xt),this.view&&this._handles.add(Object(u.a)(this,"state",this._stateHandles),xt)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([It,At]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this.view.allLayerViews;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),It),this._handles.add(Object(u.d)(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),At)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var r=[];e.forEach((function(n){if(!n.parent){var a=n.layer.parent,i=a&&"uid"in a&&t._layerViewByLayerId[a.uid],l=i&&t._activeLayerInfosByLayerViewId[i.uid];l&&-1!==e.indexOf(l)&&(r.push(n),n.parent=l,l.children.add(n),t._sortActiveLayerInfos(l.children))}})),e.removeMany(r);var n={};this.view.allLayerViews.forEach((function(e,t){return n[e.layer.uid]=t})),e.sort((function(e,t){var r=n[e.layer.uid]||0;return(n[t.layer.uid]||0)-r}))}}},{key:"_generateLayerViews",value:function(){var e=[];return Rt.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===Vt||e===Mt),r=!this.groundLegendVisible&&e===zt;return!t&&!r}},{key:"_collectLayerViews",value:function(e,t){return function r(n){return n&&n.forEach((function(n){t.push(n),r(n[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,r=this.layerInfos;return!r||!r.length||r.some((function(r){return t._hasLayerInfo(r,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var r=this._isLayerUIDMatching(e.layer,t.layer.uid);return r&&(this._layerInfosByLayerViewId[t.uid]=e),r}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var r=this;return e&&e.some((function(e){return r._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!Ct.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(Object(u.d)(e,"legendEnabled, layer.legendEnabled",(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,r=this,n=e.layer,a=e.uid,i=this._layerInfosByLayerViewId[a],l=this._activeLayerInfosByLayerViewId[a];if(!l){var s=i&&void 0!==i.title&&i.layer.uid===n.uid;l=new Lt({layer:n,layerView:e,title:s?i.title:n.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:i&&i.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[a]=l}var o=n.parent&&"uid"in n.parent&&this._layerViewByLayerId[null==(t=n.parent)?void 0:t.uid];if(l.parent=this._activeLayerInfosByLayerViewId[null==o?void 0:o.uid],!this._handles.has(a)){var c=[Object(u.d)(n,"title",(function(e){return r._titleHandle(e,l)})),Object(u.d)(n,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",(function(){return r._constructLegendElements(l)})),Object(u.k)(this.view,"stationary",(function(){return r._scaleHandle(l)})),Object(u.d)(e,"_effectiveRenderer",(function(){return r._constructLegendElements(l)}))];if(this.respectLayerVisibility){var d=Object(u.d)(e,"legendEnabled",(function(e){return r._legendEnabledHandle(e,l)})),y=Object(u.d)(n,"legendEnabled",(function(e){return r._legendEnabledHandle(e,l)}));c.push(d,y)}this._handles.add(c,a)}l.isScaleDriven||this._constructLegendElements(l),this._addActiveLayerInfo(l)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){e.isScaleDriven&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,r=e.layerView,n=e.layer;if(this._isLayerActive(r)&&-1===this.activeLayerInfos.indexOf(e)){var a=e.parent;if(a)-1===a.children.indexOf(e)&&a.children.push(e),this._sortActiveLayerInfos(a.children);else{var i,l=null==(i=this.layerInfos)?void 0:i.some((function(e){return e.layer.uid===n.uid}));n.parent&&"uid"in n.parent&&!l?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var s=[];this._activeLayerInfosWithNoParent.forEach((function(e){var r=e.layer.parent,n=r&&"uid"in r&&t._layerViewByLayerId[null==r?void 0:r.uid],a=t._activeLayerInfosByLayerViewId[null==n?void 0:n.uid];a&&(s.push(e),e.parent=a)})),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t=this,r=e.layer;"featureCollections"in r&&r.featureCollections?e.buildLegendElementsForFeatureCollections(r.featureCollections):"renderer"in r&&r.renderer?e.buildLegendElementsForRenderer(r.renderer):"url"in r&&r.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return t._constructLegendElements(e)}))}}]),r}(v.a);Object(o.a)([Object(f.b)({type:Et})],Ft.prototype,"activeLayerInfos",void 0),Object(o.a)([Object(f.b)()],Ft.prototype,"basemapLegendVisible",void 0),Object(o.a)([Object(f.b)()],Ft.prototype,"groundLegendVisible",void 0),Object(o.a)([Object(f.b)()],Ft.prototype,"keepCacheOnDestroy",void 0),Object(o.a)([Object(f.b)()],Ft.prototype,"respectLayerVisibility",void 0),Object(o.a)([Object(f.b)()],Ft.prototype,"layerInfos",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],Ft.prototype,"state",null),Object(o.a)([Object(f.b)()],Ft.prototype,"view",void 0);var Tt=Ft=Object(o.a)([Object(b.a)("esri.widgets.Legend.LegendViewModel")],Ft),Dt=r(170),Nt=r(1268),Pt=r(713),Bt=r(734),Ht="http://www.w3.org/2000/svg",Ut="esri-relationship-ramp--diamond__container",qt="esri-relationship-ramp--diamond__left-column",Wt="esri-relationship-ramp--diamond__right-column",Gt="esri-relationship-ramp--diamond__middle-column",Jt="esri-relationship-ramp--diamond__middle-column--label",Qt="esri-relationship-ramp--diamond__middle-column--ramp",Kt="esri-relationship-ramp--square__table",Xt="esri-relationship-ramp--square__table-row",Yt="esri-relationship-ramp--square__table-cell",Zt="esri-relationship-ramp--square__table-label",$t="esri-relationship-ramp--square__table-label--left-bottom",er="esri-relationship-ramp--square__table-label--right-bottom",tr="esri-relationship-ramp--square__table-label--left-top",rr="esri-relationship-ramp--square__table-label--right-top";function nr(e,t,r){var n=e.focus,a=e.labels,i=!!n,l=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:60,a=e.focus,i=e.numClasses,l=e.colors,s=e.rotation,o=!!a,c=Math.sqrt(Math.pow(n,2)+Math.pow(n,2))+(o?0:5),u=null;null!=r&&(u="opacity: ".concat(r));for(var d=[],y=[],h=[],f=(n||75)/i,b=0;b<i;b++)for(var p=b*f,v=0;v<i;v++){var m=v*f,g=Object(Nt.b)(l[b][v]),O=Object(Nt.c)(null),_={type:"rect",x:m,y:p,width:f,height:f};d.push(Object(Nt.f)(g)),y.push(Object(Nt.h)(_,g.fill,O,null)),h.push(Object(Nt.d)(_))}var j=10,w=15,L=15,k=10,x=null;o||(x="margin: -15px -15px -18px -15px");var S=ar("left",a,t),I=ar("right",a,t),A=Object(Nt.a)(h),E=Object(Nt.e)(A,c,c,0,!1,s,!1),C=Object(Nt.e)(A,c,c,0,!1,o?-45:null,!1);return Object(Bt.a)("div",{style:u,class:o?Qt:Yt},Object(Bt.a)("svg",{xmlns:Ht,width:c,height:c,style:x},Object(Bt.a)("defs",null,Object(Bt.a)("marker",{id:"".concat(t,"_arrowStart"),markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},Object(Bt.a)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),Object(Bt.a)("marker",{id:"".concat(t,"_arrowEnd"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},Object(Bt.a)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),Object(Bt.a)("g",{transform:E},y),Object(Bt.a)("g",{transform:C},Object(Bt.a)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":S.markerStart,"marker-end":S.markerEnd,x1:-j,y1:n-w,x2:-j,y2:w}),Object(Bt.a)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":I.markerStart,"marker-end":I.markerEnd,x1:L,y1:n+k,x2:n-L,y2:n+k}))))}(e,t,r);return i?Object(Bt.a)("div",{class:Ut},Object(Bt.a)("div",{class:qt},a.left),Object(Bt.a)("div",{class:Gt},Object(Bt.a)("div",{class:Jt},a.top),l,Object(Bt.a)("div",{class:Jt},a.bottom)),Object(Bt.a)("div",{class:Wt},a.right)):Object(Bt.a)("div",{class:Kt},Object(Bt.a)("div",{class:Xt},Object(Bt.a)("div",{class:Object(Pt.a)(Yt,Zt,er)},a.left),Object(Bt.a)("div",{class:Yt}),Object(Bt.a)("div",{class:Object(Pt.a)(Yt,Zt,$t)},a.top)),Object(Bt.a)("div",{class:Xt},Object(Bt.a)("div",{class:Yt}),l,Object(Bt.a)("div",{class:Yt})),Object(Bt.a)("div",{class:Xt},Object(Bt.a)("div",{class:Object(Pt.a)(Yt,Zt,rr)},a.bottom),Object(Bt.a)("div",{class:Yt}),Object(Bt.a)("div",{class:Object(Pt.a)(Yt,Zt,tr)},a.right)))}function ar(e,t,r){var n="".concat(r,"_arrowStart"),a="".concat(r,"_arrowEnd"),i="left"===e,l={markerStart:null,markerEnd:null};switch(t){case"HL":i?l.markerStart="url(#".concat(a,")"):l.markerEnd="url(#".concat(n,")");break;case"LL":l.markerStart="url(#".concat(a,")");break;case"LH":i?l.markerEnd="url(#".concat(n,")"):l.markerStart="url(#".concat(a,")");break;default:l.markerEnd="url(#".concat(n,")")}return l}r(1114);var ir=r(1115),lr=Object(ir.a)(),sr=20,or=10,cr=20,ur="esri-univariate-above-and-below-ramp__symbol",dr="esri-legend__color-ramp";function yr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?Object(Bt.a)("svg",{height:"4",width:"10"},Object(Bt.a)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):Object(Bt.a)("svg",{height:"10",width:"10"},Object(Bt.a)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function hr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",r=document.createElement("div");return r.style.height="".concat(sr,"px"),r.className=ur,null!=e&&(r.style.opacity=e.toString()),lr.append(r,yr.bind(null,t)),r}function fr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",n=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,a){if(n&&2===a)e.preview=hr(t,r);else{var i=Object(C.c)(e.size)+("horizontal"===r?cr:or),l="div"===e.preview.tagName.toLowerCase(),s=l?e.preview:document.createElement("div");s.className=ur,"horizontal"===r?s.style.width="".concat(i,"px"):s.style.height="".concat(i,"px"),l||s.appendChild(e.preview),e.preview=s}}))}function br(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",r=e.infos;return"classic"===t?(Object(C.c)(r[0].size)+or)/2:(Object(C.c)(r[0].size)-Object(C.c)(r[r.length-1].size))/2}function pr(e,t){if(!e)return null;var r=e.infos.map((function(e){return e.color})),n=Object(N.b)("full"===t.type?r:"above"===t.type?r.slice(0,3):r.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment});return n.className=dr,null!=t.opacity&&(n.style.opacity=t.opacity.toString()),n}function vr(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",a=0,i=e.infos,l=Math.floor(i.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?i.length-1:l,c=s;c<=o;c++)a+=r&&c===l?"horizontal"===n?10:sr:Object(C.c)(i[c].size)+("horizontal"===n?cr:or);return Math.round(a)}function mr(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",a=vr(e,t,r,n),i=e.infos,l=Math.floor(i.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?i.length-1:l,c="full"===t?i[s].size+i[o].size:"above"===t?i[s].size:i[o].size,u=r?"vertical"===n?sr:10:0,d="vertical"===n?or*("full"===t?2:1):cr*("full"===t?2:1);return Math.round(a-(Object(C.c)(c)/2+u/2+d/2))}function gr(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",i=e.infos,l=i.filter((function(e){return"size-ramp"===e.type}))[0],s=i.filter((function(e){return"color-ramp"===e.type}))[0];return l&&((l=Object(n.a)({},l)).infos=Object(j.a)(l.infos)),s&&((s=Object(n.a)({},s)).infos=Object(j.a)(s.infos)),fr(l,t,a,!0),"horizontal"===a&&(l.infos.reverse(),null==(r=s)||r.infos.reverse()),{sizeRampElement:l,colorRampElement:s}}function Or(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",a=e.infos,i=a.filter((function(e){return"size-ramp"===e.type}))[0],l=a.filter((function(e){return"color-ramp"===e.type}))[0];return i&&((i=Object(n.a)({},i)).infos=Object(j.a)(i.infos)),l&&((l=Object(n.a)({},l)).infos=Object(j.a)(l.infos)),fr(i,null,r,!1),"horizontal"===r&&(i.infos.reverse(),null==(t=l)||t.infos.reverse()),{sizeRampElement:i,colorRampElement:l}}var _r=r(967);function jr(e){e.appendChild(this)}function wr(e,t,r){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return Object(_r.a)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var n=null;return r?n=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Lr(t,r)&&(n=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),n?Object(_r.a)("showField"===n?"{field}":e[n],{field:t.field,normField:t.normField}):null}}function Lr(e,t){return!t}function kr(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var xr=r(995),Sr=r(877),Ir=r(791),Ar="esri-legend--card__carousel-indicator--activated",Er="esri-legend--card",Cr="esri-legend--stacked",Vr="esri-legend--card__carousel-title",zr="esri-legend--card__carousel-indicator",Mr="esri-legend--card__interval-separator",Rr="esri-legend--card__imagery-layer-image--stretched",Fr="esri-legend--card__image-label",Tr="esri-legend--card__layer-caption",Dr="esri-legend--card__label-element",Nr="esri-legend--card__layer-row",Pr="esri-legend--card__label-cell",Br="esri-legend--card__message",Hr="esri-legend--card__ramp-label",Ur="esri-legend--card__section",qr="esri-legend--card__service-caption-text",Wr="esri-legend--card__service-content",Gr="esri-legend--card__service",Jr="esri-legend--card__group-layer",Qr="esri-legend--card__group-layer-child",Kr="esri-legend--card__symbol",Xr="esri-legend--card__size-ramp-row",Yr="esri-legend--card__symbol-row",Zr="esri-legend--card__symbol-cell",$r="esri-legend--card__carousel-indicator-container",en="esri-legend--card__interval-separators-container",tn="esri-legend--card__relationship-label-container",rn="esri-legend--card__label-container",nn="esri-legend--card__service-caption-container",an="esri-legend--card__symbol-container",ln="esri-legend--card__size-ramp-container",sn="esri-legend--card__size-ramp-preview",on="esri-legend__size-ramp--horizontal",cn="esri-legend__ramp-labels",un="esri-legend__layer-cell esri-legend__layer-cell--info",dn="esri-univariate-above-and-below-ramp__color--card",yn=window.devicePixelRatio;var hn=function(e){Object(l.a)(r,e);var t=Object(s.a)(r);function r(e,n){var i;return Object(a.a)(this,r),(i=t.call(this,e,n))._handles=new c.a,i._hasIndicators=!1,i._selectedSectionName=null,i._sectionNames=[],i._sectionMap=new Map,i.activeLayerInfos=null,i.headingLevel=3,i.layout="stack",i.messages=null,i.messagesCommon=null,i.type="card",i.view=null,i}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.own([this.watch("activeLayerInfos",(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)}))])}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=768||"stack"===this.layout;var t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var n=this._sectionNames.length,a=this._sectionNames.map((function(t,r){var a=Object(_r.a)(e.messagesCommon.pagination.pageText,{index:r+1,total:n});return Object(Bt.a)("div",{key:t,role:"tab",id:t,"aria-label":a,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:a,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes(zr,Object(Dt.a)({},Ar,e._selectedSectionName===t)),"data-section-name":t})})),i=this._hasIndicators&&n>1?Object(Bt.a)("div",{class:$r,key:"carousel-navigation",role:"tablist"},a):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):r&&r.length?r:null,s=Object(Dt.a)({},Cr,this._hasIndicators);return Object(Bt.a)("div",{class:this.classes(Er,s)},l||Object(Bt.a)("div",{class:Br},this.messages.noLegend),i)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,r="ArrowLeft"===t?-1:1,n=e.target.getAttribute("data-section-name"),a=this._sectionNames.indexOf(n),i=this._sectionNames,l=null;-1!==a&&(i[a+r]?l=document.getElementById(i[a+r]):"ArrowLeft"===t?l=document.getElementById(i[i.length-1]):"ArrowRight"===t&&(l=document.getElementById(i[0])),l&&l.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var r="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(r),t._watchForSectionChanges(e.children),t._handles.add(e.watch("version",(function(){return t._generateSectionNames()})),r)}));var r="activeLayerInfos-collection-change";this._handles.remove(r),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),r)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,r){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(r)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(r,n){t._sectionNames.push(t._getSectionName(e.layer,r,n))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var r=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return Object(Bt.a)("div",{key:e.layer.uid,class:this.classes(Gr,Jr)},Object(Bt.a)("div",{class:nn},e.title),r)}var n=e.legendElements;if(n&&!n.length)return null;var a=n.some((function(e){return"relationship-ramp"===e.type})),i=n.map((function(r,n){return t._renderLegendForElement(r,e,n,a)})).filter((function(e){return!!e}));if(!i.length)return null;var l=Object(Dt.a)({},Qr,!!e.parent);return Object(Bt.a)("div",{key:e.layer.uid,class:this.classes(Gr,l)},Object(Bt.a)("div",{class:nn},Object(Bt.a)("div",{class:qr},e.title)),Object(Bt.a)("div",{class:Wr},i))}},{key:"_renderLegendForElement",value:function(e,t,r){var n=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=t.layer,c=null;if("string"==typeof e.title)c=e.title;else if(e.title){var u=e.title,d=wr(this.messages,u,i||l);c=u.title?"".concat(u.title," (").concat(d,")"):d}var y=this._getSectionName(o,e,r),h=this._hasIndicators?Object(Bt.a)("div",null,Object(Bt.a)(xr.a,{level:this.headingLevel,class:Vr},t.title),Object(Bt.a)(xr.a,{level:this.headingLevel+1,class:Tr},c)):c?Object(Bt.a)(xr.a,{level:this.headingLevel,class:Tr},c):null,f=null;if("symbol-table"===e.type){var b=e.infos.map((function(r,a){return n._renderLegendForElementInfo(r,t,e.legendType,a)})).filter((function(e){return!!e}));if(b.length){var p,v=b[0].properties.classes&&b[0].properties.classes[Yr],m=(p={},Object(Dt.a)(p,rn,!v&&!a),Object(Dt.a)(p,tn,a),p);f=Object(Bt.a)("div",{class:this.classes(m)},b)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?f=this._renderLegendForRamp(e,o.opacity):s?f=this._renderSizeRamp(e,o.opacity):"relationship-ramp"===e.type?f=nr(e,this.id,o.opacity):"univariate-above-and-below-ramp"===e.type?f=this._renderUnivariateAboveAndBelowRamp(e,o.opacity):"univariate-color-size-ramp"===e.type&&(f=this._renderUnivariateColorSizeRamp(e,o.opacity));if(!f)return null;var g=Object(Bt.a)("div",{key:y,class:Ur,id:"".concat(y,"-panel"),role:"tabpanel","aria-labelledby":y,tabIndex:0},[h,f]);return this._sectionMap.set(y,g),g}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t){var r=gr(e,t,"horizontal"),n=r.sizeRampElement,a=r.colorRampElement,i=vr(n,"full",!0,"horizontal"),l=mr(n,"above",!0,"horizontal"),s=mr(n,"below",!0,"horizontal"),o=pr(a,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"above"}),c=pr(a,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"below"}),u=br(n,"card"),d=n.infos.map((function(e){return e.label})),y=d.length-1,h=d.map((function(e,t){return 0===t||t===y?Object(Bt.a)("div",{key:t},e):null})),f={marginTop:"3px",marginLeft:"".concat(u,"px"),display:"flex"},b={width:"".concat(i,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return Object(Bt.a)("div",{class:Nr,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},Object(Bt.a)("div",{class:this.classes(an,on),styles:{display:"flex",flexDirection:"row"}},n.infos.map((function(e,t){return Object(Bt.a)("div",{key:t,class:Kr,bind:e.preview,afterCreate:jr})}))),o?Object(Bt.a)("div",{class:dn,styles:f,key:"color-ramp-preview"},Object(Bt.a)("div",{bind:o,afterCreate:jr}),Object(Bt.a)("div",{bind:c,afterCreate:jr})):null,Object(Bt.a)("div",{class:un},Object(Bt.a)("div",{class:cn,styles:b},h)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t){var r=Or(e,"horizontal"),n=r.sizeRampElement,a=r.colorRampElement,i=vr(n,"full",!1,"horizontal"),l=pr(a,{width:mr(n,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full"}),s=br(n,"card"),o=n.infos.length-1,c=n.infos.map((function(e,t){return 0===t||t===o?Object(Bt.a)("div",{key:t},e.label):null})),u={marginTop:"3px",marginLeft:"".concat(s,"px"),display:"flex"},d={width:"".concat(i,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return Object(Bt.a)("div",{class:Nr,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},Object(Bt.a)("div",{class:this.classes(an,on),styles:{display:"flex",flexDirection:"row"}},n.infos.map((function(e,t){return Object(Bt.a)("div",{key:t,class:Kr,bind:e.preview,afterCreate:jr})}))),Object(Bt.a)("div",{class:dn,styles:u,key:"color-ramp-preview"},Object(Bt.a)("div",{bind:l,afterCreate:jr})),Object(Bt.a)("div",{class:un},Object(Bt.a)("div",{class:cn,styles:d},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,r,n){var a=t.layer;if(e.type)return this._renderLegendForElement(e,t,n);var i=kr(a,r);if(e.preview){var l,s;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return Object(Bt.a)("div",{key:n,bind:e.preview,afterCreate:jr});var o=Object(Dt.a)({},Zr,this._hasIndicators);return Object(Bt.a)("div",{key:n,class:this.classes(Nr,Object(Dt.a)({},Yr,this._hasIndicators))},Object(Bt.a)("div",{class:this.classes(o),bind:e.preview,afterCreate:jr}),Object(Bt.a)("div",{class:this.classes(Fr,Object(Dt.a)({},Pr,this._hasIndicators))},wr(this.messages,e.label,!1)||""))}var c=255,u=255,d=255,y=0,h=255,f=255,b=255,p=0,v=e.symbol.color&&e.symbol.color.a,m=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;v&&(c=e.symbol.color.r,u=e.symbol.color.g,d=e.symbol.color.b,y=e.symbol.color.a*a.opacity),m&&(h=e.symbol.outline.color.r,f=e.symbol.outline.color.g,b=e.symbol.outline.color.b,p=e.symbol.outline.color.a*a.opacity);var g=null==(l=null==(s=e.symbol.color)?void 0:s.isBright)||l,O=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",_={background:v?"rgba(".concat(c,", ").concat(u,", ").concat(d,", ").concat(y,")"):"none",color:g?"black":"white",textShadow:"-1px -1px 0 ".concat(O,",\n                                              1px -1px 0 ").concat(O,",\n                                              -1px 1px 0 ").concat(O,",\n                                              1px 1px 0 ").concat(O),border:m?"1px solid rgba(".concat(h,", ").concat(f,", ").concat(b,", ").concat(p,")"):"none"};return Object(Bt.a)("div",{key:n,class:Nr},Object(Bt.a)("div",{class:Dr,styles:_}," ",e.label," "))}if(e.src){var j=this._renderImage(e,a,i);return Object(Bt.a)("div",{key:n,class:Nr},j,Object(Bt.a)("div",{class:Fr},e.label||""))}}},{key:"_renderImage",value:function(e,t,r){var n,a=e.label,i=e.src,l=e.opacity,s=(n={},Object(Dt.a)(n,Rr,r),Object(Dt.a)(n,Kr,!r),n),o={opacity:"".concat(null!=l?l:t.opacity)};return Object(Bt.a)("img",{alt:wr(this.messages,a,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,r=t[0],n=t[t.length-1],a=r.symbol,i=this._hasIndicators,l=Object(C.c)(r.size+r.outlineSize)*yn,s=Object(C.c)(n.size+n.outlineSize)*yn,o=i?l:l+50*yn,c=i?l/2+50*yn:l,u=function(e){if(e){if(e.type.indexOf("3d")>-1){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===r||"cone"===r||"tetrahedron"===r}return"triangle"===e.style}}(a),d=function(e){if(e){if(e.type.indexOf("3d")>-1){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1),n=r.resource&&r.resource.primitive;return"circle"===n||"cross"===n||"kite"===n||"sphere"===n||"cube"===n||"diamond"===n}var a=e.style;return"circle"===a||"diamond"===a||"cross"===a}}(a),y=document.createElement("canvas");y.width=o,y.height=c,y.style.width=y.width/yn+"px",y.style.height=y.height/yn+"px";var h=y.getContext("2d");if(i){h.beginPath();var f=o/2-s/2,b=c;h.moveTo(0,0),h.lineTo(f,b);var p=o,v=o/2+s/2,m=c;h.moveTo(p,0),h.lineTo(v,m)}else{h.beginPath();var g=c/2-s/2,O=o;h.moveTo(0,g),h.lineTo(O,0);var _=c/2+s/2,j=o,w=c;h.moveTo(0,_),h.lineTo(j,w)}return h.strokeStyle="#ddd",h.stroke(),Object(Bt.a)("div",{bind:y,afterCreate:jr,styles:i?{display:"flex",marginTop:"-".concat(u?0:d?l/2:0,"px"),marginBottom:"-".concat(u?s:d?s/2:0,"px")}:{display:"flex",marginRight:"-".concat(u?0:d?l/2:0,"px"),marginLeft:"-".concat(u?0:d?s/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var r=e.infos,n=r[0].label,a=r[r.length-1].label,i=r[0].preview,l=r[r.length-1].preview,s=this._hasIndicators,o={"flex-direction":s?"column":"row-reverse"};i&&((i=i.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var c={opacity:null!=t?"".concat(t):""};return Object(Bt.a)("div",{class:this.classes(Nr,Object(Dt.a)({},Xr,s))},Object(Bt.a)("div",{class:Hr},s?n:a),Object(Bt.a)("div",{class:ln,styles:o},Object(Bt.a)("div",{bind:i,afterCreate:jr,class:sn,styles:c}),this._renderSizeRampLines(e),Object(Bt.a)("div",{bind:l,afterCreate:jr,class:ln,styles:c})),Object(Bt.a)("div",{class:Hr},s?a:n))}},{key:"_renderLegendForRamp",value:function(e,t){var r=e.infos,n="heatmap-ramp"===e.type,a=r.length-1,i=25,l=a>2&&!n?25*a:100,s=l+20,o=10,c=r.slice(0).reverse();c.forEach((function(e,t){e.offset=n?e.ratio:t/a}));var u=c.length-1,d=c.length%2!=0&&c[c.length/2|0],y=d&&Object(Bt.a)("div",{class:en},Object(Bt.a)("div",{class:Mr},"|"),Object(Bt.a)("div",{class:Hr},d.label)),h=r[r.length-1].label,f=r[0].label,b=null;null!=t&&(b="opacity: ".concat(t));var p=[[{shape:{type:"path",path:"M0 ".concat(i/2," L").concat(o," 0 L").concat(o," ").concat(i," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:o,y:0,width:l,height:i},fill:{type:"linear",x1:o,y1:0,x2:l+o,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(l+o," 0 L").concat(s," ").concat(i/2," L").concat(l+o," ").concat(i," Z")},fill:c[u].color,stroke:{width:0}}]],v=Object(Nt.g)(p,s,i),m=this.messages;return Object(Bt.a)("div",{class:Nr},Object(Bt.a)("div",{class:Hr},n?m[h]:h),Object(Bt.a)("div",{class:an},Object(Bt.a)("div",{style:b},v),y),Object(Bt.a)("div",{class:Hr},n?m[f]:f))}}]),r}(p.a);Object(o.a)([Object(f.b)()],hn.prototype,"activeLayerInfos",void 0),Object(o.a)([Object(f.b)()],hn.prototype,"headingLevel",void 0),Object(o.a)([Object(f.b)()],hn.prototype,"layout",void 0),Object(o.a)([Object(f.b)(),Object(Ir.a)("esri/widgets/Legend/t9n/Legend")],hn.prototype,"messages",void 0),Object(o.a)([Object(f.b)(),Object(Ir.a)("esri/t9n/common")],hn.prototype,"messagesCommon",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],hn.prototype,"type",void 0),Object(o.a)([Object(f.b)()],hn.prototype,"view",void 0),Object(o.a)([Object(Sr.a)()],hn.prototype,"_selectSection",null);var fn=hn=Object(o.a)([Object(b.a)("esri.widgets.Legend.styles.Card")],hn),bn="esri-legend__service",pn="esri-legend__service-label",vn="esri-legend__layer",mn="esri-legend__group-layer",gn="esri-legend__group-layer-child",On="esri-legend__layer-table",_n="esri-legend__layer-table--size-ramp",jn="esri-legend__layer-child-table",wn="esri-legend__layer-caption",Ln="esri-legend__layer-body",kn="esri-legend__layer-row",xn="esri-legend__layer-cell esri-legend__layer-cell--info",Sn="esri-legend__imagery-layer-image--stretched",In="esri-legend__imagery-layer-info--stretched",An="esri-legend__layer-cell esri-legend__layer-cell--symbols",En="esri-legend__symbol",Cn="esri-legend__ramps",Vn="esri-legend__size-ramp",zn="esri-legend__color-ramp",Mn="esri-legend__opacity-ramp",Rn="esri-legend__ramp-labels",Fn="esri-legend__ramp-label",Tn="esri-univariate-above-and-below-ramp__label",Dn="esri-legend__message",Nn="esri-widget__heading",Pn={display:"flex",alignItems:"flex-start"},Bn={marginLeft:"3px"},Hn={display:"table-cell",verticalAlign:"middle"},Un=function(e){Object(l.a)(r,e);var t=Object(s.a)(r);function r(e,n){var i;return Object(a.a)(this,r),(i=t.call(this,e,n)).activeLayerInfos=null,i.headingLevel=3,i.messages=null,i.type="classic",i}return Object(i.a)(r,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return Object(Bt.a)("div",null,r&&r.length?r:Object(Bt.a)("div",{class:Dn},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var r=!!e.children.length,n="".concat("esri-legend__").concat(e.layer.uid,"-version-").concat(e.version),a=e.title?Object(xr.a)({level:this.headingLevel,class:this.classes(Nn,pn)},e.title):null;if(r){var i=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return Object(Bt.a)("div",{key:n,class:this.classes(bn,mn)},a,i)}var l=e.legendElements;if(l&&!l.length)return null;var s=l.map((function(r){return t._renderLegendForElement(r,e.layer)})).filter((function(e){return!!e}));if(!s.length)return null;var o=Object(Dt.a)({},gn,!!e.parent);return Object(Bt.a)("div",{key:n,class:this.classes(bn,o),tabIndex:0},a,Object(Bt.a)("div",{class:vn},s))}},{key:"_renderLegendForElement",value:function(e,t,r){var n=this,a="color-ramp"===e.type,i="opacity-ramp"===e.type,l="size-ramp"===e.type,s=null;if("symbol-table"===e.type||l){var o=e.infos.map((function(r){return n._renderLegendForElementInfo(r,t,l,e.legendType)})).filter((function(e){return!!e}));o.length&&(s=Object(Bt.a)("div",{class:Ln},o))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?s=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?s=nr(e,this.id,t.opacity):"univariate-above-and-below-ramp"===e.type?s=this._renderUnivariateAboveAndBelowRamp(e,t.opacity):"univariate-color-size-ramp"===e.type&&(s=this._renderUnivariateColorSizeRamp(e,t.opacity));if(!s)return null;var c=e.title,u=null;if("string"==typeof c)u=c;else if(c){var d=wr(this.messages,c,a||i);u=Lr(0,a||i)&&c.title?"".concat(c.title," (").concat(d,")"):d}var y=r?jn:On,h=u?Object(Bt.a)("div",{class:wn},u):null,f=Object(Dt.a)({},_n,l||!r);return Object(Bt.a)("div",{class:this.classes(y,f)},h,s)}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t){var r=this,n=gr(e,t),a=n.sizeRampElement,i=n.colorRampElement,l=mr(a,"above",!0),s=mr(a,"below",!0),o=pr(i,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"above"}),c=pr(i,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"below"}),u=br(a),d=a.infos.map((function(e){return e.label})),y=d.map((function(e,t){var r=2===t;return 0===t?Object(Bt.a)("div",{key:t,class:e?o?Tn:Fn:null},e):r?Object(Bt.a)("div",null):null})),h=d.length-1,f=Math.floor(d.length/2),b=d.map((function(e,t){return t===f||t===h?Object(Bt.a)("div",{key:t,class:e?o?Tn:Fn:null},e):null})),p={display:"table-cell",verticalAlign:"middle"},v={marginTop:"".concat(u,"px")},m={height:"".concat(l,"px")},g={height:"".concat(s,"px")};return Object(Bt.a)("div",{key:"univariate-above-and-below-ramp-preview",styles:Pn},Object(Bt.a)("div",{class:Ln},a.infos.map((function(e,t){return Object(Bt.a)("div",{class:r.classes(kn,Vn)},Object(Bt.a)("div",{class:En,styles:p,bind:e.preview,afterCreate:jr}),o||t%2!=0?null:Object(Bt.a)("div",{class:xn},d[t]))}))),o?Object(Bt.a)("div",{styles:v,key:"color-ramp-preview"},Object(Bt.a)("div",{styles:Bn},Object(Bt.a)("div",{styles:Hn},Object(Bt.a)("div",{class:Cn,bind:o,afterCreate:jr})),Object(Bt.a)("div",{styles:Hn},Object(Bt.a)("div",{class:Rn,styles:m},y))),Object(Bt.a)("div",{styles:Bn},Object(Bt.a)("div",{styles:Hn},Object(Bt.a)("div",{class:Cn,bind:c,afterCreate:jr})),Object(Bt.a)("div",{styles:Hn},Object(Bt.a)("div",{class:Rn,styles:g},b)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t){var r=this,n=Or(e),a=n.sizeRampElement,i=n.colorRampElement,l=br(a),s=mr(a,"full",!1),o=pr(i,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"full"}),c=a.infos.length-1,u=a.infos.map((function(e,t){return 0===t||t===c?Object(Bt.a)("div",{key:t,class:e.label?i?Tn:Fn:null},e.label):null})),d={display:"table-cell",verticalAlign:"middle"},y={marginTop:"".concat(l,"px")},h={height:"".concat(s,"px")};return Object(Bt.a)("div",{key:"univariate-above-and-below-ramp-preview",styles:Pn},Object(Bt.a)("div",{class:Ln},a.infos.map((function(e){return Object(Bt.a)("div",{class:r.classes(kn,Vn)},Object(Bt.a)("div",{class:En,styles:d,bind:e.preview,afterCreate:jr}))}))),Object(Bt.a)("div",{styles:y,key:"color-ramp-preview"},Object(Bt.a)("div",{styles:Bn},Object(Bt.a)("div",{styles:Hn},Object(Bt.a)("div",{class:Cn,bind:o,afterCreate:jr})),Object(Bt.a)("div",{styles:Hn},Object(Bt.a)("div",{class:Rn,styles:h},u)))))}},{key:"_renderLegendForRamp",value:function(e,t){var r=this,n=e.infos,a="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,s=e.preview,o=a?Mn:"";s.className="".concat(zn," ").concat(o),null!=t&&(s.style.opacity=t.toString());var c=n.map((function(e){return Object(Bt.a)("div",{class:e.label?Fn:null},i?r.messages[e.label]:l?r._getStretchStopLabel(e):e.label)})),u={width:"".concat(24,"px")},d={height:s.style.height};return Object(Bt.a)("div",{class:kn},Object(Bt.a)("div",{class:An,styles:u},Object(Bt.a)("div",{class:Cn,bind:s,afterCreate:jr})),Object(Bt.a)("div",{class:xn},Object(Bt.a)("div",{class:Rn,styles:d},c)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:Object(q.b)(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,r,n){var a;if(e.type)return this._renderLegendForElement(e,t,!0);var i=null,l=kr(t,n);if(e.preview?i=Object(Bt.a)("div",{class:En,bind:e.preview,afterCreate:jr}):e.src&&(i=this._renderImage(e,t,l)),!i)return null;var s=Object(Dt.a)({},In,l),o=(a={},Object(Dt.a)(a,In,l),Object(Dt.a)(a,Vn,!l&&r),a);return Object(Bt.a)("div",{class:kn},Object(Bt.a)("div",{class:this.classes(An,o)},i),Object(Bt.a)("div",{class:this.classes(xn,s)},wr(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,r){var n,a=e.label,i=e.src,l=e.opacity,s=(n={},Object(Dt.a)(n,Sn,r),Object(Dt.a)(n,En,!r),n),o={opacity:"".concat(null!=l?l:t.opacity)};return Object(Bt.a)("img",{alt:wr(this.messages,a,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}}]),r}(p.a);Object(o.a)([Object(f.b)()],Un.prototype,"activeLayerInfos",void 0),Object(o.a)([Object(f.b)()],Un.prototype,"headingLevel",void 0),Object(o.a)([Object(f.b)(),Object(Ir.a)("esri/widgets/Legend/t9n/Legend")],Un.prototype,"messages",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],Un.prototype,"type",void 0);var qn=Un=Object(o.a)([Object(b.a)("esri.widgets.Legend.styles.Classic")],Un),Wn="esri-legend",Gn="esri-widget",Jn="esri-widget--panel",Qn="esri-icon-layer-list",Kn=function(e){Object(l.a)(r,e);var t=Object(s.a)(r);function r(e,n){var i;return Object(a.a)(this,r),(i=t.call(this,e,n))._handles=new c.a,i.activeLayerInfos=null,i.basemapLegendVisible=!1,i.groundLegendVisible=!1,i.headingLevel=3,i.keepCacheOnDestroy=!1,i.respectLayerVisibility=!0,i.iconClass=Qn,i.label=void 0,i.layerInfos=null,i.messages=null,i.style=new qn,i.view=null,i.viewModel=new Tt,i}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.own(Object(u.b)(this,"activeLayerInfos","change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),Object(u.d)(this,"headingLevel",(function(t){var r=e.style;r&&(r.headingLevel=t)})),Object(u.a)(this,"style",(function(t,r){r&&t!==r&&r.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"castStyle",value:function(e){if(e instanceof fn||e instanceof qn)return e;if("string"==typeof e)return"card"===e?new fn:new qn;if(e&&"string"==typeof e.type){var t=Object(n.a)({},e);return delete t.type,new("card"===e.type?fn:qn)(t)}return new qn}},{key:"render",value:function(){return Object(Bt.a)("div",{class:this.classes(Wn,Gn,this.style instanceof qn?Jn:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,r=Object(u.a)(e,"version",(function(){return t.scheduleRender()}));this._handles.add(r,"version_".concat(e.layer.uid));var n=Object(u.b)(e,"children","change",(function(){e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}));this._handles.add(n,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),r}(p.a);Object(o.a)([Object(d.a)("viewModel.activeLayerInfos")],Kn.prototype,"activeLayerInfos",void 0),Object(o.a)([Object(d.a)("viewModel.basemapLegendVisible")],Kn.prototype,"basemapLegendVisible",void 0),Object(o.a)([Object(d.a)("viewModel.groundLegendVisible")],Kn.prototype,"groundLegendVisible",void 0),Object(o.a)([Object(f.b)()],Kn.prototype,"headingLevel",void 0),Object(o.a)([Object(d.a)("viewModel.keepCacheOnDestroy")],Kn.prototype,"keepCacheOnDestroy",void 0),Object(o.a)([Object(d.a)("viewModel.respectLayerVisibility")],Kn.prototype,"respectLayerVisibility",void 0),Object(o.a)([Object(f.b)()],Kn.prototype,"iconClass",void 0),Object(o.a)([Object(f.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Kn.prototype,"label",void 0),Object(o.a)([Object(d.a)("viewModel.layerInfos")],Kn.prototype,"layerInfos",void 0),Object(o.a)([Object(f.b)(),Object(Ir.a)("esri/widgets/Legend/t9n/Legend")],Kn.prototype,"messages",void 0),Object(o.a)([Object(f.b)()],Kn.prototype,"style",void 0),Object(o.a)([Object(y.a)("style")],Kn.prototype,"castStyle",null),Object(o.a)([Object(d.a)("viewModel.view")],Kn.prototype,"view",void 0),Object(o.a)([Object(f.b)()],Kn.prototype,"viewModel",void 0);var Xn=Kn=Object(o.a)([Object(b.a)("esri.widgets.Legend")],Kn);t.default=Xn},982:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var n=r(646);function a(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!l(e,t))}function i(e,t,r){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===r.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2}))||!l(e,t)}function l(e,t){if(!e||!e.length)return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var a,i=0,l=r.length,s=Object(n.a)(e);try{for(s.s();!(a=s.n()).done;){for(var o=a.value.id;i<l&&r[i]!==o;)i++;if(i>=l)return!1}}catch(c){s.e(c)}finally{s.f()}return!0}function s(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}}}]);
//# sourceMappingURL=100.0bd68798.chunk.js.map